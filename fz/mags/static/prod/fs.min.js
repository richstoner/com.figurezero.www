var map,tlpoint,brpoint,drawnItems,pubmedLayer,dxLayer,ytLayer,vimLayer,urlLayer,geojsonViewLayer,refhighlightLayer,activeFigure,resetMap=function(){map.fitBounds(new L.LatLngBounds(tlpoint,brpoint))},zoomToGlobal=function(d){window.appModel.zoomTo(d)},highlightMapGlobal=function(d){window.appModel.highlightMap(d)},clearHighLightsGlobal=function(){geojsonViewLayer.clearLayers()},highlightRefGlobal=function(d){window.appModel.highlightRef(d)},clearRefHighLightsGlobal=function(){refhighlightLayer.clearLayers()},
zoomRefGlobal=function(d){window.appModel.zoomRef(d)},starFigureGlobal=function(d){window.appModel.starFigure(d)};$(window).resize(function(){500>window.innerWidth?($("#map").height(window.innerHeight-80),$(".tab-content").height(window.innerHeight-100)):$("#map").height(window.innerHeight+60)});
var loadMapFromFigureObject=function(d){L.TileLayer.Common=L.TileLayer.extend({initialize:function(b){L.TileLayer.prototype.initialize.call(this,this.url,b)}});L.Projection.NoWrap={project:function(b){return new L.Point(b.lng,b.lat)},unproject:function(b){return new L.LatLng(b.y,b.x,!0)}};L.CRS.Direct=L.Util.extend({},L.CRS,{code:"Direct",projection:L.Projection.NoWrap,transformation:new L.Transformation(1,0,1,0)});var c,e;c=d.get("imagePropertiesLocation");e=d.get("tileLocation");$.ajax({type:"GET",
url:c,dataType:"xml",success:function(b){$imgxml=$(b).find("IMAGE_PROPERTIES");var b=$imgxml.attr("HEIGHT"),a=$imgxml.attr("WIDTH");imageHeight=b;imageWidth=a;var c=Math.ceil(Math.log(Math.max(a,b)/256)/Math.log(2));500>window.innerWidth?($("#map").height(window.innerHeight-80),$(".tab-content").height(window.innerHeight-100)):$("#map").height(window.innerHeight+60);map=new L.Map("map",{crs:L.CRS.Direct,center:new L.LatLng(0,0),zoom:c,minZoom:1,scrollWheelZoom:!0,worldCopyJump:!1,attributionControl:!1});
$("#activityView").hide().ajaxStart(function(){$(this).show()}).ajaxStop(function(){$(this).hide()});var h=new L.Control.FullScreen;map.addControl(h);h=L.Control.extend({options:{position:"topright"},_createButton:function(a,b,c,f,i){b=L.DomUtil.create("a",b,c);b.href="#";b.title=a;L.DomEvent.addListener(b,"click",L.DomEvent.stopPropagation).addListener(b,"click",L.DomEvent.preventDefault).addListener(b,"click",f,i);return b},onAdd:function(){var a=L.DomUtil.create("div","leaflet-control-draw");this._createButton("reset zoom",
"leaflet-control-draw-zoom",a,resetMap,window);return a}});map.addControl(new h);map.setView(map.layerPointToLatLng(new L.Point($("#map").width(),$("#map").height())),c,!0);L.TileLayer.FigureZero=L.TileLayer.Common.extend({url:e+"TileGroup0/{z}-{x}-{y}.jpg",options:{noWrap:!0,maxZoom:c}});c=new L.TileLayer.FigureZero;map.addLayer(c);tlpoint=map.layerPointToLatLng(new L.Point(0,b));tlpoint.lat*=0.1;brpoint=map.layerPointToLatLng(new L.Point(a,0));brpoint.lng*=0.1;map.fitBounds(new L.LatLngBounds(tlpoint,
brpoint));console.log("Hi dan");var i=L.icon({iconUrl:"/static/css/images/pubmed-marker.png",iconSize:[32,37],iconAnchor:[16,37],popupAnchor:[0,-28]}),d=L.icon({iconUrl:"/static/css/images/doi-marker.png",iconSize:[32,37],iconAnchor:[16,37],popupAnchor:[0,-28]}),j=L.icon({iconUrl:"/static/css/images/vim-marker.png",iconSize:[32,37],iconAnchor:[16,37],popupAnchor:[0,-28]}),l=L.icon({iconUrl:"/static/css/images/yt-marker.png",iconSize:[32,37],iconAnchor:[16,37],popupAnchor:[0,-28]}),r=L.icon({iconUrl:"/static/css/images/other-marker.png",
iconSize:[32,37],iconAnchor:[16,37],popupAnchor:[0,-28]}),m=L.icon({iconUrl:"/static/css/images/highlight-marker.png",iconSize:[32,37],iconAnchor:[16,37],popupAnchor:[0,-28]});geojsonViewLayer=L.geoJson(null,{onEachFeature:onEachRectFeature,style:{color:"#0099ff",weight:2,opacity:0.8,fillColor:"#000000",fillOpacity:0.75}}).addTo(map);pubmedLayer=L.geoJson(null,{pointToLayer:function(a,b){return L.marker(b,{icon:i})},onEachFeature:onEachPointFeature}).addTo(map);dxLayer=L.geoJson(null,{pointToLayer:function(a,
b){return L.marker(b,{icon:d})},onEachFeature:onEachPointFeature}).addTo(map);ytLayer=L.geoJson(null,{pointToLayer:function(a,b){return L.marker(b,{icon:l})},onEachFeature:onEachPointFeature}).addTo(map);vimLayer=L.geoJson(null,{pointToLayer:function(a,b){return L.marker(b,{icon:j})},onEachFeature:onEachPointFeature}).addTo(map);urlLayer=L.geoJson(null,{pointToLayer:function(a,b){return L.marker(b,{icon:r})},onEachFeature:onEachPointFeature}).addTo(map);refhighlightLayer=L.geoJson(null,{pointToLayer:function(a,
b){return L.marker(b,{icon:m})},onEachFeature:onEachPointFeature}).addTo(map);window.appModel.addAllRefs();window.appModel.addAllView();window.appModel.addFigureInfo()}})},layerToGeometry=function(d){var c,e=[];if(L.Marker&&d instanceof L.Marker)return c="Point",d=LatLngToCoords(d._latlng),{type:c,coordinates:d};if(L.Polygon&&d instanceof L.Polygon)return c="Polygon",e=LatLngsToCoords(d._latlngs,1),{type:c,coordinates:[e]};if(L.Polyline&&d instanceof L.Polyline)return c="LineString",e=LatLngsToCoords(d._latlngs),
{type:c,coordinates:e}},LatLngToCoords=function(d,c){var e=parseFloat(c?d.lng:d.lat);return[parseFloat(c?d.lat:d.lng),e]},LatLngsToCoords=function(d,c,e){var b,a=[],f,h;f=0;for(h=d.length;f<h;f++)b=c?LatLngToCoords(d[f],c-1,e):LatLngToCoords(d[f],e),a.push(b);return a};function onEachRectFeature(d){d.properties&&d.properties.title&&(new L.LatLng(d.geometry.coordinates[0][3][1],d.geometry.coordinates[0][3][0]),new L.LatLng(d.geometry.coordinates[0][1][1],d.geometry.coordinates[0][1][0]))}
function onEachPointFeature(d,c){if("Pubmed ID"==d.properties.reftype){if(d.properties&&d.properties.title)c.on("click",function(){500>window.innerWidth?c.bindPopup('<h3><span class="heavier">'+d.properties.title+"</span></h3><br><b>Authors :</b>"+d.properties.authors+"<br><b>Abstract :</b>"+d.properties.description+'</p><p><a target="_blank" href="http://www.ncbi.nlm.nih.gov/pubmed?term='+d.properties.id+' ">Pubmed Link</a></p>',{maxWidth:250}):c.bindPopup('<h3><span class="heavier">'+d.properties.title+
"</span></h3><br><b>Authors :</b>"+d.properties.authors+"<br><b>Abstract :</b>"+d.properties.description+'</p><p><a target="_blank" href="http://www.ncbi.nlm.nih.gov/pubmed?term='+d.properties.id+' ">Pubmed Link</a></p>',{maxWidth:500});var e=new L.LatLng(d.geometry.coordinates[1],d.geometry.coordinates[0]);map.panTo(e);c.openPopup()})}else if("Vimeo ID"==d.properties.reftype){if(d.properties&&d.properties.title)c.on("click",function(){500>window.innerWidth?c.bindPopup('<iframe src="http://player.vimeo.com/video/'+
d.properties.id+'" width="320" height="240" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>',{maxWidth:250}):c.bindPopup('<iframe src="http://player.vimeo.com/video/'+d.properties.id+'" width="320" height="240" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>',{maxWidth:500});var e=new L.LatLng(d.geometry.coordinates[1],d.geometry.coordinates[0]);map.panTo(e);c.openPopup()})}else if("DX.DOI"==d.properties.reftype){if(d.properties&&
d.properties.title)c.on("click",function(){500>window.innerWidth?c.bindPopup('<h3><span class="heavier">'+d.properties.title+"</span></h3><br><b>Authors :</b>"+d.properties.authors+"<br><b>Abstract :</b>"+d.properties.description+'</p><p><a target="_blank" href="'+d.properties.id+' ">DOI Link</a></p>',{maxWidth:320}):c.bindPopup('<h3><span class="heavier">'+d.properties.title+"</span></h3><br><b>Authors :</b>"+d.properties.authors+"<br><b>Abstract :</b>"+d.properties.description+'</p><p><a target="_blank" href="'+
d.properties.id+' ">DOI Link</a></p>',{maxWidth:500});var e=new L.LatLng(d.geometry.coordinates[1],d.geometry.coordinates[0]);map.panTo(e);c.openPopup()})}else if("Youtube ID"==d.properties.reftype){if(d.properties&&d.properties.title)c.on("click",function(){500>window.innerWidth?c.bindPopup('<iframe id="ytplayer" type="text/html" width="320" height="240" src="http://www.youtube.com/embed/'+d.properties.id+'?autoplay=1&origin=http://figurezero.com" frameborder="0"/>',{maxWidth:320}):c.bindPopup('<iframe id="ytplayer" type="text/html" width="320" height="240" src="http://www.youtube.com/embed/'+
d.properties.id+'?autoplay=1&origin=http://figurezero.com" frameborder="0"/>',{maxWidth:500});var e=new L.LatLng(d.geometry.coordinates[1],d.geometry.coordinates[0]);map.panTo(e);c.openPopup()})}else if("Other URL"==d.properties.reftype&&d.properties&&d.properties.title)c.on("click",function(){500>window.innerWidth?c.bindPopup('<h3><span class="heavier">'+d.properties.title+"</span></h3><br>"+d.properties.authors+"<br>"+d.properties.description+'</p><p><a target="_blank" href="'+d.properties.id+' ">Original URL</a></p>',
{maxWidth:250}):-1!=d.properties.title.indexOf("iframe")?c.bindPopup('<iframe id="ytplayer" type="text/html" width="500" height="500" src="'+d.properties.id+'" frameborder="0"/>',{maxWidth:500}):c.bindPopup('<h3><a target="_blank" href="'+d.properties.id+' "><span class="heavier">'+d.properties.title+"</span></a></h3><br>"+d.properties.authors+"</p>",{maxWidth:500});var e=new L.LatLng(d.geometry.coordinates[1],d.geometry.coordinates[0]);map.panTo(e);c.openPopup()})}
$(function(){Parse.$=jQuery;Parse.initialize("nY5yXtyaq5zJ1TnCfGOBDa6vu9IX9WwhDJTxx6eu","2HnPlp2kBNpS66dsPdVHRlec1b8BVzKnbZc5XknC");var d=Parse.Object.extend("UploadObject",{initialize:function(){console.log("initialized FZ object")},toggle:function(){console.log("called Toggle")}});Parse.Collection.extend({model:d});var c=Parse.Object.extend("AppState",{defaults:{filter:"all"}}),e=Parse.View.extend({tagName:"div",template:_.template($("#reference-template").html()),events:{},initialize:function(){_.bindAll(this,
"render")},render:function(){$(this.el).html(this.template(this.model));return this}}),b=Parse.View.extend({tagName:"div",template:_.template($("#view-template").html()),events:{},initialize:function(){_.bindAll(this,"render")},render:function(){$(this.el).html(this.template(this.model));return this}}),a=Parse.View.extend({events:{"click #signinButton":"signInUser","click #logoutButton":"logOut","click #unpublishButton":"unpublishPublish","click #editTextButton":"showEditText","click #reload-text-button":"reloadText",
"click #save-text-button":"saveCurrentText","click #signin-button":"signinPressed","keypress #signup-password":"signinPressed","click #createaccount-button":"createAccountPressed","keypress #signup-email":"createAccountPressed"},el:".content",initialize:function(){_.bindAll(this,"render","zoomTo","zoomRef","highlightMap","highlightRef","addFigureInfo","addAllView","addAllRefs","signInUser","logOut","starFigure","unpublishPublish","showEditText","reloadText","saveCurrentText","signinPressed","createAccountPressed",
"setInitialZoom");this.activeFigureID=$("#parseID").html();$(this.el).html(_.template($("#publish-app-template").html()));this.query=new Parse.Query(d);this.query.get(this.activeFigureID,{success:function(a){$("#activityView").hide();$("#myTab a").click(function(a){a.preventDefault();$(this).tab("show")});$("#dropDownButton").dropdown();$("#dropDownLogin input").click(function(a){a.stopPropagation()});$("#dropDownLogin button").click(function(a){a.stopPropagation();window.appModel.signInUser()});
activeFigure=$.extend(!0,{},a);7<=a.toJSON().stat&&loadMapFromFigureObject(a)},error:function(){console.log("error");$("#activityView").hide();$("#myTab a").click(function(a){a.preventDefault();$(this).tab("show")});$("#dropDownButton").dropdown();$("#dropDownLogin input").click(function(a){a.stopPropagation()});$("#dropDownLogin button").click(function(a){a.stopPropagation();window.appModel.signInUser()});alert("figure not available - it may not be public?")}})},setInitialZoom:function(){},signinPressed:function(b){if(13==
b.keyCode||"click"==b.type){var c=this,b=this.$("#signup-username").val().toLowerCase(),f=this.$("#signup-password").val();Parse.User.logIn(b,f,{success:function(){$("#myModal").modal("hide");window.appModel.undelegateEvents();window.appModel=new a;delete c},error:function(){$("#error").text("Invalid username or password. Please try again.").show()}})}},createAccountPressed:function(b){if(13==b.keyCode||"click"==b.type){var c=this,b=this.$("#signup-username").val().toLowerCase(),f=this.$("#signup-email").val(),
h=this.$("#signup-password").val(),d=new Parse.User;d.set("username",b);d.set("password",h);d.set("email",f);d.set("ACL",new Parse.ACL);d.signUp(null,{success:function(){$("#myModal").modal("hide");window.appModel.undelegateEvents();window.appModel=new a;delete c},error:function(a,b){$("#error").text(b.message).show()}})}},signInUser:function(){var b=this,c=this.$("#login-username").val(),f=this.$("#login-password").val();Parse.User.logIn(c,f,{success:function(){$("#dropDownButton").dropdown("toggle");
window.appModel=new a;b.undelegateEvents();delete b},error:function(){this.$("#login-username").val("");this.$("#login-password").val("")}})},reloadText:function(){var a=this;this.query.get(this.activeFigureID,{success:function(){activeFigure.fetch();var b=activeFigure.get("figureTitleEDIT"),c=activeFigure.get("authorList"),f=activeFigure.get("tag");a.$(".text-core").remove();a.$("#textareacontainer").html('<textarea id="textarea" style="max-width:200px;" rows="1"></textarea>');a.$("#figureTitleEDIT").val(b);
a.$("#figureAuthor").val(c);a.$("#figureDescriptionEDIT").val(activeFigure.get("figureDescription"));a.$("#textarea").textext({plugins:"tags prompt focus autocomplete ajax arrow",tagsItems:f,prompt:"tags",ajax:{url:"/api/tags.json",dataType:"json",cacheResults:!0}})},error:function(){alert("figure retrieve error")}})},showEditText:function(){console.log("here");$('#myTab a[href="#edit"]').tab("show")},starFigure:function(a){var b=Parse.User.current(),c="/star/"+a+"/"+b.id,f="/unstar/"+a+"/"+b.id;
if(b.has("starArray")){var h=$.inArray(a,b.get("starArray"));console.log(h);0<=h?($.get(f,function(a){console.log(a)}),b.get("starArray").splice(h,1),b.save(null,{success:function(){var a='<a class="btn btn-small" onclick="starFigureGlobal(\''+activeFigure.id+'\')"><span class="icon-star"></span></a>';$("#starSpan").html(a)}})):($.get(c,function(a){console.log(a)}),b.get("starArray").push(a),b.save(null,{success:function(){var a='<a class="btn btn-warning btn-small" onclick="starFigureGlobal(\''+
activeFigure.id+'\')"><span class="icon-star icon-white"></span></a>';$("#starSpan").html(a)}}))}else $.get(c,function(a){console.log(a)}),c=[],c.push(a),b.set("starArray",c),b.save(null,{success:function(){var a='<a class="btn btn-warning btn-small" onclick="starFigureGlobal(\''+activeFigure.id+'\')"><span class="icon-star icon-white"></span></a>';$("#starSpan").html(a)}})},zoomRef:function(a){a=activeFigure.get("referenceArray")[a];a=new L.LatLng(a.geometry.coordinates[1],a.geometry.coordinates[0]);
map.panTo(a)},zoomTo:function(a){var b=activeFigure.get("viewArray")[a],a=new L.LatLng(b.geometry.coordinates[1][3][1],b.geometry.coordinates[1][3][0]),b=new L.LatLng(b.geometry.coordinates[1][1][1],b.geometry.coordinates[1][1][0]);map.fitBounds(new L.LatLngBounds(a,b))},highlightMap:function(a){geojsonViewLayer.addData(activeFigure.get("viewArray")[a])},highlightRef:function(a){refhighlightLayer.addData(activeFigure.get("referenceArray")[a])},addFigureInfo:function(){var a=activeFigure.get("tag");
tag_str=tag_html="";_.each(a,function(a){tag_html+='<a href="/library/#/tag/'+a+'" >'+a+"</a>, ";tag_str+=a.replace(/(\r\n|\n|\r)/gm,"")+", "});var b=activeFigure.get("figureTitle");60<b.length&&(b="@figurezero "+b.substr(0,57)+"... "+tag_str);shortURL=activeFigure.get("shortenedURL");addthis.button("#at-box",{},{url:shortURL,title:b,data_track_addressbar:!1});this.$("#figureTitle").html(activeFigure.get("figureTitle"));this.$("#figureAuthor").html(activeFigure.get("authorList"));this.$("#figureDescription").html(activeFigure.get("figureDescription"));
document.title=activeFigure.get("figureTitle");activeFigure.get("rootID");activeFigure.get("imageID");activeFigure.get("originalExtension");activeFigure.get("originalFilename");var b=activeFigure.get("shortenedURL"),c=activeFigure.get("qrLinkURL");this.$("#figureTags").html(tag_html);this.$("#figureExternal").html('<a target="_blank" href="'+activeFigure.get("figureExternal")+'">'+activeFigure.get("figureExternal")+"</a>");this.$("#qrcode").html('<a target="_blank" href="'+c+' "><img style="width:200px; height:200px;" src="'+
c+'"/></a>');this.$("#shortLinkURL").html('<a target="_blank" href="'+b+' ">'+b+"</a>");self.$(".text-core").remove();self.$("#textareacontainer").html('<textarea id="textarea" style="max-width:200px;" rows="1"></textarea>');self.$("#figureTitleEDIT").val(activeFigure.get("figureTitle"));self.$("#figureDescriptionEDIT").val(activeFigure.get("figureDescription"));this.$("#figureExternalEDIT").html(activeFigure.get("figureExternal"));self.$("#textarea").textext({plugins:"tags prompt focus autocomplete ajax arrow",
tagsItems:a,prompt:"tags",ajax:{url:"/api/tags.json",dataType:"json",cacheResults:!0}});var a=Parse.User.current(),b=Object.keys(activeFigure.getACL().permissionsById),f="";_.each(b,function(a){"*"!=a&&(f=a)});a?a.id==f?activeFigure.get("published")?(this.$("#publishButton").html('<div class="btn-group pull-right"><button class="btn btn-success btn-small">Published</button><button class="btn btn-primary btn-small dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"><li><a id="unpublishButton" href="#">Unpublish figure</a></li></ul></div>'),
$("#editTextSpan").html("<div class='clearfix'></div>"),$("#editRegionSpan").html("<div class='clearfix'></div>"),$("#editReferenceSpan").html("<div class='clearfix'></div>")):(this.$("#publishButton").html('<div class="btn-group pull-right"><button class="btn btn-primary btn-small">Unpublished</button><button class="btn btn-success btn-small dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"><li><a id="unpublishButton" href="#">Publish figure</a></li></ul></div>'),
a='<div class="btn-group pull-right" style="margin-right:30px"><a href="/ref/'+activeFigure.id+'" id="editRefButton" class="btn btn-small btn-primary"><i class="icon-edit icon-white"></i>  Edit references</a></div>',b='<div class="btn-group pull-right" style="margin-right:30px"><a href="/roi/'+activeFigure.id+'" id="editROIButton" class="btn btn-small  btn-primary"><i class="icon-edit icon-white"></i>  Edit regions</a></div>',$("#editReferenceSpan").html(a),$("#editRegionSpan").html(b),$("#editTextSpan").html('<div class="btn-group pull-right" style="margin-right:30px"><button id="editTextButton" class="btn btn-small btn-primary"><i class="icon-edit icon-white"></i>  Edit text</button></div><div class="clearfix"></div>')):
(console.log("this is not your figure"),this.$("#publishButton").html(""),$("#editTextSpan").html("<div class='clearfix'></div>"),$("#editRegionSpan").html("<div class='clearfix'></div>"),$("#editReferenceSpan").html("<div class='clearfix'></div>"),b=!1,0<=$.inArray(activeFigure.id,a.get("starArray"))&&(b=!0),b?(console.log("and starred"),a='<a class="btn btn-warning btn-small" onclick="starFigureGlobal(\''+activeFigure.id+'\')"><span class="icon-star icon-white"></span></a>'):(console.log("and not starred"),
a='<a class="btn btn-small" onclick="starFigureGlobal(\''+activeFigure.id+'\')"><span class="icon-star"></span></a>'),$("#starSpan").html(a)):(this.$("#publishButton").html(""),$("#editTextSpan").html("<div class='clearfix'></div>"),$("#editRegionSpan").html("<div class='clearfix'></div>"),$("#editReferenceSpan").html("<div class='clearfix'></div>"));this.setInitialZoom()},addAllView:function(){map&&(this.$("#viewContainer").html(""),geojsonViewLayer.clearLayers(),_.each(activeFigure.get("viewArray"),
function(a,c){a.index=c;var f=new b({model:a});this.$("#viewContainer").append(f.render().el)}))},unpublishPublish:function(){activeFigure.get("published")?(activeFigure.getACL().setPublicReadAccess(!1),activeFigure.set("published",!1),activeFigure.save(null,{success:function(){$("#publishButton").html('<div class="btn-group pull-right"><button class="btn btn-primary btn-small">Unpublished</button><button class="btn btn-success btn-small dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"><li><a id="unpublishButton" href="#">Publish figure</a></li></ul></div>');
var a='<div class="btn-group pull-right" style="margin-right:30px"><a href="/ref/'+activeFigure.id+'" id="editRefButton" class="btn btn-small btn-primary"><i class="icon-edit icon-white"></i>  Edit references</a></div>',b='<div class="btn-group pull-right" style="margin-right:30px"><a href="/roi/'+activeFigure.id+'" id="editROIButton" class="btn btn-small  btn-primary"><i class="icon-edit icon-white"></i>  Edit regions</a></div>';$("#editReferenceSpan").html(a);$("#editRegionSpan").html(b);$("#editTextSpan").html('<div class="btn-group pull-right" style="margin-right:30px"><button id="editTextButton" class="btn btn-small btn-primary"><i class="icon-edit icon-white"></i>  Edit text</button></div><div class="clearfix"></div>')},
error:function(){}})):(activeFigure.getACL().setPublicReadAccess(!0),activeFigure.set("published",!0),activeFigure.save(null,{success:function(){$("#publishButton").html('<div class="btn-group pull-right"><button class="btn btn-success btn-small">Published</button><button class="btn btn-primary btn-small dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"><li><a id="unpublishButton" href="#">Unpublish figure</a></li></ul></div>');$("#editTextSpan").html("<div class='clearfix'></div>");
$("#editRegionSpan").html("<div class='clearfix'></div>");$("#editReferenceSpan").html("<div class='clearfix'></div>")},error:function(){}}))},saveCurrentText:function(){var a=this,b=a.$("#figureTitleEDIT").val(),c=a.$("#figureDescriptionEDIT").val(),f=a.$("#figureExternalEDIT").val(),h=a.$("#textarea").textext()[0].tags()._formData,d=a.$("#figureAuthorList").val();activeFigure.set("tag",h);activeFigure.set("figureTitle",b);activeFigure.set("figureDescription",c);activeFigure.set("figureExternal",
f);activeFigure.set("authorList",d);document.title=activeFigure.get("figureTitle");activeFigure.save({success:function(b){console.log("save successful");a.$("#figureTitle").html(b.get("figureTitle"));a.$("#figureDescription").html(b.get("figureDescription"));a.$("#figureAuthor").html(b.get("authorList"));var c=b.get("tag");tag_html="";_.each(c,function(a){tag_html+='<a href="/library/#/tag/'+a+'" >'+a+"</a>, "});a.$("#figureTags").html(tag_html);a.$("#figureExternal").html('<a target="_blank" href="'+
b.get("figureExternal")+'">'+b.get("figureExternal")+"</a>");$("#myTab a:first").tab("show")},error:function(a,b){console.log(b)}})},addAllRefs:function(){map&&(this.$("#referenceContainer").html(""),_.each(activeFigure.get("referenceArray"),function(a,b){a.index=b;var c=new e({model:a});this.$("#referenceContainer").append(c.render().el);"Pubmed ID"==a.properties.reftype?pubmedLayer.addData(a):"DX.DOI"==a.properties.reftype?dxLayer.addData(a):"Youtube ID"==a.properties.reftype?ytLayer.addData(a):
"Vimeo ID"==a.properties.reftype?vimLayer.addData(a):"Other URL"==a.properties.reftype&&urlLayer.addData(a)}))},logOut:function(){Parse.User.logOut();window.appModel=new a;this.undelegateEvents();delete this},reloadImageView:function(){resetMap()},render:function(){this.delegateEvents()}}),f=Parse.View.extend({el:$("#todoapp"),initialize:function(){this.render()},render:function(){window.appModel=new a;$("#myTab a").click(function(a){a.preventDefault();$(this).tab("show")})}}),h=Parse.Router.extend({routes:{"region/:id":"showRegion",
"*actions":"defaultRoute"},initialize:function(){},showRegion:function(a){console.log("viewing region "+a);$("#initialRegion").val(a)},defaultRoute:function(){}});new c;new h;Parse.history.start();new f});(function(){function d(a,b,c){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a._chain&&(a=a._wrapped);b._chain&&(b=b._wrapped);if(a.isEqual&&g.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&g.isFunction(b.isEqual))return b.isEqual(a);var f=k.call(a);if(f!=k.call(b))return!1;switch(f){case "[object String]":return a==""+b;case "[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==+b;case "[object RegExp]":return a.source==
b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var h=c.length;h--;)if(c[h]==a)return!0;c.push(a);var h=0,i=!0;if("[object Array]"==f){if(h=a.length,i=h==b.length)for(;h--&&(i=h in a==h in b&&d(a[h],b[h],c)););}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var e in a)if(g.has(a,e)&&(h++,!(i=g.has(b,e)&&d(a[e],b[e],c))))break;if(i){for(e in b)if(g.has(b,e)&&!h--)break;
i=!h}}c.pop();return i}var c=this,e=c._,b={},a=Array.prototype,f=Object.prototype,h=a.slice,i=a.unshift,k=f.toString,j=f.hasOwnProperty,l=a.forEach,r=a.map,m=a.reduce,s=a.reduceRight,B=a.filter,C=a.every,D=a.some,v=a.indexOf,E=a.lastIndexOf,f=Array.isArray,H=Object.keys,w=Function.prototype.bind,g=function(a){return new t(a)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=g),exports._=g):c._=g;g.VERSION="1.3.3";var n=g.each=g.forEach=function(a,
c,f){if(null!=a)if(l&&a.forEach===l)a.forEach(c,f);else if(a.length===+a.length)for(var h=0,d=a.length;h<d&&!(h in a&&c.call(f,a[h],h,a)===b);h++);else for(h in a)if(g.has(a,h)&&c.call(f,a[h],h,a)===b)break};g.map=g.collect=function(a,b,c){var f=[];if(null==a)return f;if(r&&a.map===r)return a.map(b,c);n(a,function(a,q,h){f[f.length]=b.call(c,a,q,h)});a.length===+a.length&&(f.length=a.length);return f};g.reduce=g.foldl=g.inject=function(a,b,c,f){var h=2<arguments.length;null==a&&(a=[]);if(m&&a.reduce===
m)return f&&(b=g.bind(b,f)),h?a.reduce(b,c):a.reduce(b);n(a,function(a,q,d){h?c=b.call(f,c,a,q,d):(c=a,h=!0)});if(!h)throw new TypeError("Reduce of empty array with no initial value");return c};g.reduceRight=g.foldr=function(a,b,c,f){var h=2<arguments.length;null==a&&(a=[]);if(s&&a.reduceRight===s)return f&&(b=g.bind(b,f)),h?a.reduceRight(b,c):a.reduceRight(b);var d=g.toArray(a).reverse();f&&!h&&(b=g.bind(b,f));return h?g.reduce(d,b,c,f):g.reduce(d,b)};g.find=g.detect=function(a,b,c){var f;F(a,function(a,
q,h){if(b.call(c,a,q,h))return f=a,!0});return f};g.filter=g.select=function(a,b,c){var f=[];if(null==a)return f;if(B&&a.filter===B)return a.filter(b,c);n(a,function(a,q,h){b.call(c,a,q,h)&&(f[f.length]=a)});return f};g.reject=function(a,b,c){var f=[];if(null==a)return f;n(a,function(a,q,h){b.call(c,a,q,h)||(f[f.length]=a)});return f};g.every=g.all=function(a,c,f){var h=!0;if(null==a)return h;if(C&&a.every===C)return a.every(c,f);n(a,function(a,q,d){if(!(h=h&&c.call(f,a,q,d)))return b});return!!h};
var F=g.some=g.any=function(a,c,f){c||(c=g.identity);var h=!1;if(null==a)return h;if(D&&a.some===D)return a.some(c,f);n(a,function(a,q,d){if(h||(h=c.call(f,a,q,d)))return b});return!!h};g.include=g.contains=function(a,b){return null==a?!1:v&&a.indexOf===v?-1!=a.indexOf(b):F(a,function(a){return a===b})};g.invoke=function(a,b){var c=h.call(arguments,2);return g.map(a,function(a){return(g.isFunction(b)?b||a:a[b]).apply(a,c)})};g.pluck=function(a,b){return g.map(a,function(a){return a[b]})};g.max=function(a,
b,c){if(!b&&g.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!b&&g.isEmpty(a))return-Infinity;var f={computed:-Infinity};n(a,function(a,q,h){q=b?b.call(c,a,q,h):a;q>=f.computed&&(f={value:a,computed:q})});return f.value};g.min=function(a,b,c){if(!b&&g.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!b&&g.isEmpty(a))return Infinity;var f={computed:Infinity};n(a,function(a,q,h){q=b?b.call(c,a,q,h):a;q<f.computed&&(f={value:a,computed:q})});return f.value};g.shuffle=function(a){var b=
[],c;n(a,function(a,f){c=Math.floor(Math.random()*(f+1));b[f]=b[c];b[c]=a});return b};g.sortBy=function(a,b,c){var f=g.isFunction(b)?b:function(a){return a[b]};return g.pluck(g.map(a,function(a,b,q){return{value:a,criteria:f.call(c,a,b,q)}}).sort(function(a,b){var c=a.criteria,f=b.criteria;return void 0===c?1:void 0===f?-1:c<f?-1:c>f?1:0}),"value")};g.groupBy=function(a,b){var c={},f=g.isFunction(b)?b:function(a){return a[b]};n(a,function(a,b){var q=f(a,b);(c[q]||(c[q]=[])).push(a)});return c};g.sortedIndex=
function(a,b,c){c||(c=g.identity);for(var f=0,h=a.length;f<h;){var d=f+h>>1;c(a[d])<c(b)?f=d+1:h=d}return f};g.toArray=function(a){return!a?[]:g.isArray(a)||g.isArguments(a)?h.call(a):a.toArray&&g.isFunction(a.toArray)?a.toArray():g.values(a)};g.size=function(a){return g.isArray(a)?a.length:g.keys(a).length};g.first=g.head=g.take=function(a,b,c){return null!=b&&!c?h.call(a,0,b):a[0]};g.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))};g.last=function(a,b,c){return null!=b&&!c?
h.call(a,Math.max(a.length-b,0)):a[a.length-1]};g.rest=g.tail=function(a,b,c){return h.call(a,null==b||c?1:b)};g.compact=function(a){return g.filter(a,function(a){return!!a})};g.flatten=function(a,b){return g.reduce(a,function(a,c){if(g.isArray(c))return a.concat(b?c:g.flatten(c));a[a.length]=c;return a},[])};g.without=function(a){return g.difference(a,h.call(arguments,1))};g.uniq=g.unique=function(a,b,c){var c=c?g.map(a,c):a,f=[];3>a.length&&(b=!0);g.reduce(c,function(c,h,d){if(b?g.last(c)!==h||
!c.length:!g.include(c,h))c.push(h),f.push(a[d]);return c},[]);return f};g.union=function(){return g.uniq(g.flatten(arguments,!0))};g.intersection=g.intersect=function(a){var b=h.call(arguments,1);return g.filter(g.uniq(a),function(a){return g.every(b,function(b){return 0<=g.indexOf(b,a)})})};g.difference=function(a){var b=g.flatten(h.call(arguments,1),!0);return g.filter(a,function(a){return!g.include(b,a)})};g.zip=function(){for(var a=h.call(arguments),b=g.max(g.pluck(a,"length")),c=Array(b),f=
0;f<b;f++)c[f]=g.pluck(a,""+f);return c};g.indexOf=function(a,b,c){if(null==a)return-1;var f;if(c)return c=g.sortedIndex(a,b),a[c]===b?c:-1;if(v&&a.indexOf===v)return a.indexOf(b);c=0;for(f=a.length;c<f;c++)if(c in a&&a[c]===b)return c;return-1};g.lastIndexOf=function(a,b){if(null==a)return-1;if(E&&a.lastIndexOf===E)return a.lastIndexOf(b);for(var c=a.length;c--;)if(c in a&&a[c]===b)return c;return-1};g.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0);for(var c=arguments[2]||1,f=Math.max(Math.ceil((b-
a)/c),0),h=0,d=Array(f);h<f;)d[h++]=a,a+=c;return d};var G=function(){};g.bind=function(a,b){var c,f;if(a.bind===w&&w)return w.apply(a,h.call(arguments,1));if(!g.isFunction(a))throw new TypeError;f=h.call(arguments,2);return c=function(){if(!(this instanceof c))return a.apply(b,f.concat(h.call(arguments)));G.prototype=a.prototype;var d=new G,i=a.apply(d,f.concat(h.call(arguments)));return Object(i)===i?i:d}};g.bindAll=function(a){var b=h.call(arguments,1);0==b.length&&(b=g.functions(a));n(b,function(b){a[b]=
g.bind(a[b],a)});return a};g.memoize=function(a,b){var c={};b||(b=g.identity);return function(){var f=b.apply(this,arguments);return g.has(c,f)?c[f]:c[f]=a.apply(this,arguments)}};g.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)};g.defer=function(a){return g.delay.apply(g,[a,1].concat(h.call(arguments,1)))};g.throttle=function(a,b){var c,f,h,d,i,e,k=g.debounce(function(){i=d=!1},b);return function(){c=this;f=arguments;h||(h=setTimeout(function(){h=
null;i&&a.apply(c,f);k()},b));d?i=!0:e=a.apply(c,f);k();d=!0;return e}};g.debounce=function(a,b,c){var f;return function(){var h=this,d=arguments;c&&!f&&a.apply(h,d);clearTimeout(f);f=setTimeout(function(){f=null;c||a.apply(h,d)},b)}};g.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;return c=a.apply(this,arguments)}};g.wrap=function(a,b){return function(){var c=[a].concat(h.call(arguments,0));return b.apply(this,c)}};g.compose=function(){var a=arguments;return function(){for(var b=
arguments,c=a.length-1;0<=c;c--)b=[a[c].apply(this,b)];return b[0]}};g.after=function(a,b){return 0>=a?b():function(){if(1>--a)return b.apply(this,arguments)}};g.keys=H||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)g.has(a,c)&&(b[b.length]=c);return b};g.values=function(a){return g.map(a,g.identity)};g.functions=g.methods=function(a){var b=[],c;for(c in a)g.isFunction(a[c])&&b.push(c);return b.sort()};g.extend=function(a){n(h.call(arguments,1),function(b){for(var c in b)a[c]=
b[c]});return a};g.pick=function(a){var b={};n(g.flatten(h.call(arguments,1)),function(c){c in a&&(b[c]=a[c])});return b};g.defaults=function(a){n(h.call(arguments,1),function(b){for(var c in b)null==a[c]&&(a[c]=b[c])});return a};g.clone=function(a){return!g.isObject(a)?a:g.isArray(a)?a.slice():g.extend({},a)};g.tap=function(a,b){b(a);return a};g.isEqual=function(a,b){return d(a,b,[])};g.isEmpty=function(a){if(null==a)return!0;if(g.isArray(a)||g.isString(a))return 0===a.length;for(var b in a)if(g.has(a,
b))return!1;return!0};g.isElement=function(a){return!!(a&&1==a.nodeType)};g.isArray=f||function(a){return"[object Array]"==k.call(a)};g.isObject=function(a){return a===Object(a)};g.isArguments=function(a){return"[object Arguments]"==k.call(a)};g.isArguments(arguments)||(g.isArguments=function(a){return!(!a||!g.has(a,"callee"))});g.isFunction=function(a){return"[object Function]"==k.call(a)};g.isString=function(a){return"[object String]"==k.call(a)};g.isNumber=function(a){return"[object Number]"==
k.call(a)};g.isFinite=function(a){return g.isNumber(a)&&isFinite(a)};g.isNaN=function(a){return a!==a};g.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==k.call(a)};g.isDate=function(a){return"[object Date]"==k.call(a)};g.isRegExp=function(a){return"[object RegExp]"==k.call(a)};g.isNull=function(a){return null===a};g.isUndefined=function(a){return void 0===a};g.has=function(a,b){return j.call(a,b)};g.noConflict=function(){c._=e;return this};g.identity=function(a){return a};g.times=
function(a,b,c){for(var f=0;f<a;f++)b.call(c,f)};g.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};g.result=function(a,b){if(null==a)return null;var c=a[b];return g.isFunction(c)?c.call(a):c};g.mixin=function(a){n(g.functions(a),function(b){var c=g[b]=a[b];t.prototype[b]=function(){var a=h.call(arguments);i.call(a,this._wrapped);return x(c.apply(g,a),this._chain)}})};var I=0;g.uniqueId=
function(a){var b=I++;return a?a+b:b};g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var y=/.^/,u={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},z;for(z in u)u[u[z]]=z;var J=/\\|'|\r|\n|\t|\u2028|\u2029/g,K=/\\(\\|'|r|n|t|u2028|u2029)/g,A=function(a){return a.replace(K,function(a,b){return u[b]})};g.template=function(a,b,c){c=g.defaults(c||{},g.templateSettings);a="__p+='"+a.replace(J,function(a){return"\\"+u[a]}).replace(c.escape||
y,function(a,b){return"'+\n_.escape("+A(b)+")+\n'"}).replace(c.interpolate||y,function(a,b){return"'+\n("+A(b)+")+\n'"}).replace(c.evaluate||y,function(a,b){return"';\n"+A(b)+"\n;__p+='"})+"';\n";c.variable||(a="with(obj||{}){\n"+a+"}\n");var a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n",f=new Function(c.variable||"obj","_",a);if(b)return f(b,g);b=function(a){return f.call(this,a,g)};b.source="function("+(c.variable||"obj")+"){\n"+a+"}";return b};
g.chain=function(a){return g(a).chain()};var t=function(a){this._wrapped=a};g.prototype=t.prototype;var x=function(a,b){return b?g(a).chain():a};g.mixin(g);n("pop push reverse shift sort splice unshift".split(" "),function(b){var c=a[b];t.prototype[b]=function(){var a=this._wrapped;c.apply(a,arguments);var f=a.length;("shift"==b||"splice"==b)&&0===f&&delete a[0];return x(a,this._chain)}});n(["concat","join","slice"],function(b){var c=a[b];t.prototype[b]=function(){return x(c.apply(this._wrapped,arguments),
this._chain)}});t.prototype.chain=function(){this._chain=!0;return this};t.prototype.value=function(){return this._wrapped}}).call(this);(function(d){d.Parse=d.Parse||{};d.Parse.VERSION="1.0.18"})(this);
(function(){function d(a,b,c){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a._chain&&(a=a._wrapped);b._chain&&(b=b._wrapped);if(a.isEqual&&g.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&g.isFunction(b.isEqual))return b.isEqual(a);var f=k.call(a);if(f!=k.call(b))return!1;switch(f){case "[object String]":return a==String(b);case "[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==+b;case "[object RegExp]":return a.source==
b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var h=c.length;h--;)if(c[h]==a)return!0;c.push(a);var h=0,i=!0;if("[object Array]"==f){if(h=a.length,i=h==b.length)for(;h--&&(i=h in a==h in b&&d(a[h],b[h],c)););}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var e in a)if(g.has(a,e)&&(h++,!(i=g.has(b,e)&&d(a[e],b[e],c))))break;if(i){for(e in b)if(g.has(b,e)&&!h--)break;
i=!h}}return c.pop(),i}var c=this,e=c._,b={},a=Array.prototype,f=Object.prototype,h=a.slice,i=a.unshift,k=f.toString,j=f.hasOwnProperty,l=a.forEach,r=a.map,m=a.reduce,s=a.reduceRight,B=a.filter,C=a.every,D=a.some,v=a.indexOf,E=a.lastIndexOf,f=Array.isArray,H=Object.keys,w=Function.prototype.bind,g=function(a){return new t(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=g),exports._=g):c._=g;g.VERSION="1.3.3";var n=g.each=g.forEach=function(a,c,
f){if(null!=a)if(l&&a.forEach===l)a.forEach(c,f);else if(a.length===+a.length)for(var h=0,d=a.length;h<d&&!(h in a&&c.call(f,a[h],h,a)===b);h++);else for(h in a)if(g.has(a,h)&&c.call(f,a[h],h,a)===b)break};g.map=g.collect=function(a,b,c){var f=[];return null==a?f:r&&a.map===r?a.map(b,c):(n(a,function(a,h,d){f[f.length]=b.call(c,a,h,d)}),a.length===+a.length&&(f.length=a.length),f)};g.reduce=g.foldl=g.inject=function(a,b,c,f){var h=2<arguments.length;null==a&&(a=[]);if(m&&a.reduce===m)return f&&(b=
g.bind(b,f)),h?a.reduce(b,c):a.reduce(b);n(a,function(a,d,i){h?c=b.call(f,c,a,d,i):(c=a,h=!0)});if(!h)throw new TypeError("Reduce of empty array with no initial value");return c};g.reduceRight=g.foldr=function(a,b,c,f){var h=2<arguments.length;null==a&&(a=[]);if(s&&a.reduceRight===s)return f&&(b=g.bind(b,f)),h?a.reduceRight(b,c):a.reduceRight(b);var d=g.toArray(a).reverse();return f&&!h&&(b=g.bind(b,f)),h?g.reduce(d,b,c,f):g.reduce(d,b)};g.find=g.detect=function(a,b,c){var f;return F(a,function(a,
h,d){if(b.call(c,a,h,d))return f=a,!0}),f};g.filter=g.select=function(a,b,c){var f=[];return null==a?f:B&&a.filter===B?a.filter(b,c):(n(a,function(a,h,d){b.call(c,a,h,d)&&(f[f.length]=a)}),f)};g.reject=function(a,b,c){var f=[];return null==a?f:(n(a,function(a,h,d){b.call(c,a,h,d)||(f[f.length]=a)}),f)};g.every=g.all=function(a,c,f){var h=!0;return null==a?h:C&&a.every===C?a.every(c,f):(n(a,function(a,d,i){if(!(h=h&&c.call(f,a,d,i)))return b}),!!h)};var F=g.some=g.any=function(a,c,f){c||(c=g.identity);
var h=!1;return null==a?h:D&&a.some===D?a.some(c,f):(n(a,function(a,d,i){if(h||(h=c.call(f,a,d,i)))return b}),!!h)};g.include=g.contains=function(a,b){var c=!1;return null==a?c:v&&a.indexOf===v?-1!=a.indexOf(b):(c=F(a,function(a){return a===b}),c)};g.invoke=function(a,b){var c=h.call(arguments,2);return g.map(a,function(a){return(g.isFunction(b)?b||a:a[b]).apply(a,c)})};g.pluck=function(a,b){return g.map(a,function(a){return a[b]})};g.max=function(a,b,c){if(!b&&g.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,
a);if(!b&&g.isEmpty(a))return-Infinity;var f={computed:-Infinity};return n(a,function(a,h,d){h=b?b.call(c,a,h,d):a;h>=f.computed&&(f={value:a,computed:h})}),f.value};g.min=function(a,b,c){if(!b&&g.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!b&&g.isEmpty(a))return Infinity;var f={computed:Infinity};return n(a,function(a,h,d){h=b?b.call(c,a,h,d):a;h<f.computed&&(f={value:a,computed:h})}),f.value};g.shuffle=function(a){var b=[],c;return n(a,function(a,f){c=Math.floor(Math.random()*(f+
1));b[f]=b[c];b[c]=a}),b};g.sortBy=function(a,b,c){var f=g.isFunction(b)?b:function(a){return a[b]};return g.pluck(g.map(a,function(a,b,h){return{value:a,criteria:f.call(c,a,b,h)}}).sort(function(a,b){var c=a.criteria,f=b.criteria;return void 0===c?1:void 0===f?-1:c<f?-1:c>f?1:0}),"value")};g.groupBy=function(a,b){var c={},f=g.isFunction(b)?b:function(a){return a[b]};return n(a,function(a,b){var h=f(a,b);(c[h]||(c[h]=[])).push(a)}),c};g.sortedIndex=function(a,b,c){c||(c=g.identity);for(var f=0,h=
a.length;f<h;){var d=f+h>>1;c(a[d])<c(b)?f=d+1:h=d}return f};g.toArray=function(a){return a?g.isArray(a)?h.call(a):g.isArguments(a)?h.call(a):a.toArray&&g.isFunction(a.toArray)?a.toArray():g.values(a):[]};g.size=function(a){return g.isArray(a)?a.length:g.keys(a).length};g.first=g.head=g.take=function(a,b,c){return null!=b&&!c?h.call(a,0,b):a[0]};g.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))};g.last=function(a,b,c){return null!=b&&!c?h.call(a,Math.max(a.length-b,0)):a[a.length-
1]};g.rest=g.tail=function(a,b,c){return h.call(a,null==b||c?1:b)};g.compact=function(a){return g.filter(a,function(a){return!!a})};g.flatten=function(a,b){return g.reduce(a,function(a,c){return g.isArray(c)?a.concat(b?c:g.flatten(c)):(a[a.length]=c,a)},[])};g.without=function(a){return g.difference(a,h.call(arguments,1))};g.uniq=g.unique=function(a,b,c){var c=c?g.map(a,c):a,f=[];return 3>a.length&&(b=!0),g.reduce(c,function(c,h,d){if(b?g.last(c)!==h||!c.length:!g.include(c,h))c.push(h),f.push(a[d]);
return c},[]),f};g.union=function(){return g.uniq(g.flatten(arguments,!0))};g.intersection=g.intersect=function(a){var b=h.call(arguments,1);return g.filter(g.uniq(a),function(a){return g.every(b,function(b){return 0<=g.indexOf(b,a)})})};g.difference=function(a){var b=g.flatten(h.call(arguments,1),!0);return g.filter(a,function(a){return!g.include(b,a)})};g.zip=function(){for(var a=h.call(arguments),b=g.max(g.pluck(a,"length")),c=Array(b),f=0;f<b;f++)c[f]=g.pluck(a,""+f);return c};g.indexOf=function(a,
b,c){if(null==a)return-1;var f;if(c)return f=g.sortedIndex(a,b),a[f]===b?f:-1;if(v&&a.indexOf===v)return a.indexOf(b);f=0;for(c=a.length;f<c;f++)if(f in a&&a[f]===b)return f;return-1};g.lastIndexOf=function(a,b){if(null==a)return-1;if(E&&a.lastIndexOf===E)return a.lastIndexOf(b);for(var c=a.length;c--;)if(c in a&&a[c]===b)return c;return-1};g.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0);for(var c=arguments[2]||1,f=Math.max(Math.ceil((b-a)/c),0),h=0,d=Array(f);h<f;)d[h++]=a,a+=c;return d};
var G=function(){};g.bind=function(a,b){var c,f;if(a.bind===w&&w)return w.apply(a,h.call(arguments,1));if(!g.isFunction(a))throw new TypeError;return f=h.call(arguments,2),c=function(){if(this instanceof c){G.prototype=a.prototype;var d=new G,i=a.apply(d,f.concat(h.call(arguments)));return Object(i)===i?i:d}return a.apply(b,f.concat(h.call(arguments)))}};g.bindAll=function(a){var b=h.call(arguments,1);return 0==b.length&&(b=g.functions(a)),n(b,function(b){a[b]=g.bind(a[b],a)}),a};g.memoize=function(a,
b){var c={};return b||(b=g.identity),function(){var f=b.apply(this,arguments);return g.has(c,f)?c[f]:c[f]=a.apply(this,arguments)}};g.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)};g.defer=function(a){return g.delay.apply(g,[a,1].concat(h.call(arguments,1)))};g.throttle=function(a,b){var c,f,h,d,i,e,k=g.debounce(function(){i=d=!1},b);return function(){c=this;f=arguments;return h||(h=setTimeout(function(){h=null;i&&a.apply(c,f);k()},b)),d?i=!0:
e=a.apply(c,f),k(),d=!0,e}};g.debounce=function(a,b,c){var f;return function(){var h=this,d=arguments;c&&!f&&a.apply(h,d);clearTimeout(f);f=setTimeout(function(){f=null;c||a.apply(h,d)},b)}};g.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}};g.wrap=function(a,b){return function(){var c=[a].concat(h.call(arguments,0));return b.apply(this,c)}};g.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;0<=c;c--)b=[a[c].apply(this,
b)];return b[0]}};g.after=function(a,b){return 0>=a?b():function(){if(1>--a)return b.apply(this,arguments)}};g.keys=H||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)g.has(a,c)&&(b[b.length]=c);return b};g.values=function(a){return g.map(a,g.identity)};g.functions=g.methods=function(a){var b=[],c;for(c in a)g.isFunction(a[c])&&b.push(c);return b.sort()};g.extend=function(a){return n(h.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a};g.pick=function(a){var b=
{};return n(g.flatten(h.call(arguments,1)),function(c){c in a&&(b[c]=a[c])}),b};g.defaults=function(a){return n(h.call(arguments,1),function(b){for(var c in b)null==a[c]&&(a[c]=b[c])}),a};g.clone=function(a){return g.isObject(a)?g.isArray(a)?a.slice():g.extend({},a):a};g.tap=function(a,b){return b(a),a};g.isEqual=function(a,b){return d(a,b,[])};g.isEmpty=function(a){if(null==a)return!0;if(g.isArray(a)||g.isString(a))return 0===a.length;for(var b in a)if(g.has(a,b))return!1;return!0};g.isElement=function(a){return!!a&&
1==a.nodeType};g.isArray=f||function(a){return"[object Array]"==k.call(a)};g.isObject=function(a){return a===Object(a)};g.isArguments=function(a){return"[object Arguments]"==k.call(a)};g.isArguments(arguments)||(g.isArguments=function(a){return!!a&&!!g.has(a,"callee")});g.isFunction=function(a){return"[object Function]"==k.call(a)};g.isString=function(a){return"[object String]"==k.call(a)};g.isNumber=function(a){return"[object Number]"==k.call(a)};g.isFinite=function(a){return g.isNumber(a)&&isFinite(a)};
g.isNaN=function(a){return a!==a};g.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==k.call(a)};g.isDate=function(a){return"[object Date]"==k.call(a)};g.isRegExp=function(a){return"[object RegExp]"==k.call(a)};g.isNull=function(a){return null===a};g.isUndefined=function(a){return void 0===a};g.has=function(a,b){return j.call(a,b)};g.noConflict=function(){return c._=e,this};g.identity=function(a){return a};g.times=function(a,b,c){for(var f=0;f<a;f++)b.call(c,f)};g.escape=function(a){return(""+
a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};g.result=function(a,b){if(null==a)return null;var c=a[b];return g.isFunction(c)?c.call(a):c};g.mixin=function(a){n(g.functions(a),function(b){var c=g[b]=a[b];t.prototype[b]=function(){var a=h.call(arguments);return i.call(a,this._wrapped),x(c.apply(g,a),this._chain)}})};var I=0;g.uniqueId=function(a){var b=I++;return a?a+b:b};g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,
interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var y=/.^/,u={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},z;for(z in u)u[u[z]]=z;var J=/\\|'|\r|\n|\t|\u2028|\u2029/g,K=/\\(\\|'|r|n|t|u2028|u2029)/g,A=function(a){return a.replace(K,function(a,b){return u[b]})};g.template=function(a,b,c){c=g.defaults(c||{},g.templateSettings);a="__p+='"+a.replace(J,function(a){return"\\"+u[a]}).replace(c.escape||y,function(a,b){return"'+\n_.escape("+A(b)+")+\n'"}).replace(c.interpolate||
y,function(a,b){return"'+\n("+A(b)+")+\n'"}).replace(c.evaluate||y,function(a,b){return"';\n"+A(b)+"\n;__p+='"})+"';\n";c.variable||(a="with(obj||{}){\n"+a+"}\n");var a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n",f=new Function(c.variable||"obj","_",a);if(b)return f(b,g);b=function(a){return f.call(this,a,g)};return b.source="function("+(c.variable||"obj")+"){\n"+a+"}",b};g.chain=function(a){return g(a).chain()};var t=function(a){this._wrapped=
a};g.prototype=t.prototype;var x=function(a,b){return b?g(a).chain():a};g.mixin(g);n("pop push reverse shift sort splice unshift".split(" "),function(b){var c=a[b];t.prototype[b]=function(){var a=this._wrapped;c.apply(a,arguments);var f=a.length;return("shift"==b||"splice"==b)&&0===f&&delete a[0],x(a,this._chain)}});n(["concat","join","slice"],function(b){var c=a[b];t.prototype[b]=function(){return x(c.apply(this._wrapped,arguments),this._chain)}});t.prototype.chain=function(){return this._chain=
!0,this};t.prototype.value=function(){return this._wrapped}}).call(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse;"undefined"!=typeof exports&&exports._?(c._=exports._.noConflict(),exports.Parse=c):c._=_.noConflict();"undefined"!=typeof $&&(c.$=$);var e=function(){};c.serverURL="https://api.parse.com";c.initialize=function(b,a){c._initialize(b,a)};c._initialize=function(b,a,f){c.applicationId=b;c.javaScriptKey=a;c.masterKey=f;c._useMasterKey=!1};c._getParsePath=function(b){if(!c.applicationId)throw"You need to call Parse.initialize before using Parse.";b||(b="");
if(!c._.isString(b))throw"Tried to get a localStorage path that wasn't a String.";return"/"===b[0]&&(b=b.substring(1)),"Parse/"+c.applicationId+"/"+b};c._installationId=null;c._getInstallationId=function(){if(c._installationId)return c._installationId;var b=c._getParsePath("installationId");c._installationId=localStorage.getItem(b);if(!c._installationId||""===c._installationId){var a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};c._installationId=a()+a()+"-"+a()+
"-"+a()+"-"+a()+"-"+a()+a()+a();localStorage.setItem(b,c._installationId)}return c._installationId};c._parseDate=function(b){b=/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$/.exec(b);return!b?null:new Date(Date.UTC(b[1]||0,(b[2]||1)-1,b[3]||0,b[4]||0,b[5]||0,b[6]||0,b[8]||0))};c._ajaxIE8=function(b,a,c,h,d){var e=new XDomainRequest;e.onload=function(){var a;try{a=JSON.parse(e.responseText)}catch(b){d&&d(e)}a&&h&&h(a,e)};e.onerror=e.ontimeout=function(){d(e)};
e.onprogress=function(){};e.open(b,a);e.send(c)};c._ajax=function(b,a,f,h,d){if("undefined"!=typeof XDomainRequest)return c._ajaxIE8(b,a,f,h,d);var e=!1,j=new XMLHttpRequest;j.onreadystatechange=function(){if(4===j.readyState&&!e)if(e=!0,200<=j.status&&300>j.status){var a;try{a=JSON.parse(j.responseText)}catch(b){d&&d(j)}a&&h&&h(a,j)}else d&&d(j)};j.open(b,a,!0);j.setRequestHeader("Content-Type","text/plain");j.send(f)};c._extend=function(b,a){var f,h=this,d;f=(b&&b.hasOwnProperty("constructor")?
d=b.constructor:d=function(){h.apply(this,arguments)},c._.extend(d,h),e.prototype=h.prototype,d.prototype=new e,b&&c._.extend(d.prototype,b),a&&c._.extend(d,a),d.prototype.constructor=d,d.__super__=h.prototype,d);return f.extend=this.extend,f};c._request=function(b,a,f,h,d,e){if(!c.applicationId)throw"You must specify your applicationId using Parse.initialize";if(!c.javaScriptKey&&!c.masterKey)throw"You must specify a key using Parse.initialize";if("classes"!==b&&"users"!==b&&"login"!==b&&"requestPasswordReset"!==
b)throw"First argument must be one of classes, users, or login, not '"+b+"'.";b=c.serverURL+"/1/"+b;a&&(b+="/"+a);f&&(b+="/"+f);d=c._.clone(d||{});"POST"!==h&&(d._method=h,h="POST");d._ApplicationId=c.applicationId;c._useMasterKey?d._MasterKey=c.masterKey:d._JavaScriptKey=c.javaScriptKey;d._ClientVersion="js"+c.VERSION;d._InstallationId=c._getInstallationId();(a=c.User.current())&&a._sessionToken&&(d._SessionToken=a._sessionToken);d=JSON.stringify(d);c._ajax(h,b,d,e.success,e.error)};c._getValue=
function(b,a){return!b||!b[a]?null:c._.isFunction(b[a])?b[a]():b[a]};c._encode=function(b,a){var f=c._;if(b instanceof c.Object){if(!a||f.include(a,b)||!b._hasData)return b._toPointer();if(!b.dirty())return a=a.concat(b),c._encode(b._toFullJSON(a),a);throw"Can't fully embed a dirty object";}if(b instanceof c.ACL)return b.toJSON();if(b instanceof Date)return{__type:"Date",iso:b.toJSON()};if(b instanceof c.GeoPoint)return b.toJSON();if(f.isArray(b))return f.map(b,function(b){return c._encode(b,a)});
if(f.isRegExp(b))return b.source;if(b instanceof c.Relation||b instanceof c.Op)return b.toJSON();if(b instanceof Object){var h={};return c._each(b,function(b,f){h[f]=c._encode(b,a)}),h}return b};c._decode=function(b,a){var f=c._;return!f.isObject(a)?a:f.isArray(a)?(c._each(a,function(b,f){a[f]=c._decode(f,b)}),a):a instanceof c.Object||a instanceof c.Op?a:a.__op?c.Op._decode(a):a.objectId?"Pointer"===a.__type?(f=c.Object._create(a.className),f._finishFetch({objectId:a.objectId},!1),f):"Object"===
a.__type?(f=a.className,delete a.__type,delete a.className,f=c.Object._create(f),f._finishFetch(a,!0),f):(c._each(a,function(b,f){a[f]=c._decode(f,b)}),c.Object._create(a.className,a)):"Date"===a.__type?c._parseDate(a.iso):"GeoPoint"===a.__type?new c.GeoPoint({latitude:a.latitude,longitude:a.longitude}):"ACL"===b?a instanceof c.ACL?a:new c.ACL(a):"Relation"===a.__type?(f=new c.Relation(null,b),f.targetClassName=a.className,f):a};c._each=function(b,a){var f=c._;f.isObject(b)?f.each(f.keys(b),function(c){a(b[c],
c)}):f.each(b,a)};c._isNullOrUndefined=function(b){return c._.isNull(b)||c._.isUndefined(b)}})(this);
(function(d){d.Parse=d.Parse||{};var d=d.Parse,c=d._;d.Error=function(c,b){this.code=c;this.message=b};c.extend(d.Error,{OTHER_CAUSE:-1,INTERNAL_SERVER_ERROR:1,CONNECTION_FAILED:100,OBJECT_NOT_FOUND:101,INVALID_QUERY:102,INVALID_CLASS_NAME:103,MISSING_OBJECT_ID:104,INVALID_KEY_NAME:105,INVALID_POINTER:106,INVALID_JSON:107,COMMAND_UNAVAILABLE:108,NOT_INITIALIZED:109,INCORRECT_TYPE:111,INVALID_CHANNEL_NAME:112,PUSH_MISCONFIGURED:115,OBJECT_TOO_LARGE:116,OPERATION_FORBIDDEN:119,CACHE_MISS:120,INVALID_NESTED_KEY:121,
INVALID_FILE_NAME:122,INVALID_ACL:123,TIMEOUT:124,INVALID_EMAIL_ADDRESS:125,DUPLICATE_VALUE:137,INVALID_ROLE_NAME:139,EXCEEDED_QUOTA:140,USERNAME_MISSING:200,PASSWORD_MISSING:201,USERNAME_TAKEN:202,EMAIL_TAKEN:203,EMAIL_MISSING:204,EMAIL_NOT_FOUND:205,SESSION_MISSING:206,MUST_CREATE_USER_THROUGH_SIGNUP:207,ACCOUNT_ALREADY_LINKED:208,LINKED_ID_MISSING:250,INVALID_LINKED_SESSION:251,UNSUPPORTED_SERVICE:252})})(this);
(function(){var d=this.Parse||(this.Parse={}),c=/\s+/,e=Array.prototype.slice;d.Events={on:function(b,a,f){var h,d,e,j,l;if(!a)return this;b=b.split(c);h=this._callbacks||(this._callbacks={});for(d=b.shift();d;)e=(l=h[d])?l.tail:{},e.next=j={},e.context=f,e.callback=a,h[d]={tail:j,next:l?l.next:e},d=b.shift();return this},off:function(b,a,f){var h,d,e,j,l,r;if(d=this._callbacks){if(!b&&!a&&!f)return delete this._callbacks,this;b=b?b.split(c):_.keys(d);for(h=b.shift();h;)if(e=d[h],delete d[h],e&&(a||
f)){j=e.tail;for(e=e.next;e!==j;)l=e.callback,r=e.context,(a&&l!==a||f&&r!==f)&&this.on(h,l,r),e=e.next;h=b.shift()}return this}},trigger:function(b){var a,f,h,d,k,j;if(!(h=this._callbacks))return this;k=h.all;b=b.split(c);j=e.call(arguments,1);for(a=b.shift();a;){if(f=h[a])for(d=f.tail;(f=f.next)!==d;)f.callback.apply(f.context||this,j);if(f=k){d=f.tail;for(a=[a].concat(j);(f=f.next)!==d;)f.callback.apply(f.context||this,a)}a=b.shift()}return this}};d.Events.bind=d.Events.on;d.Events.unbind=d.Events.off}).call(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse,e=c._;c.GeoPoint=function(b,a){e.isArray(b)?(c.GeoPoint._validate(b[0],b[1]),this.latitude=b[0],this.longitude=b[1]):e.isObject(b)?(c.GeoPoint._validate(b.latitude,b.longitude),this.latitude=b.latitude,this.longitude=b.longitude):e.isNumber(b)&&e.isNumber(a)?(c.GeoPoint._validate(b,a),this.latitude=b,this.longitude=a):(this.latitude=0,this.longitude=0);var f=this;this.__defineGetter__&&this.__defineSetter__&&(this._latitude=this.latitude,this._longitude=
this.longitude,this.__defineGetter__("latitude",function(){return f._latitude}),this.__defineGetter__("longitude",function(){return f._longitude}),this.__defineSetter__("latitude",function(a){c.GeoPoint._validate(a,f.longitude);f._latitude=a}),this.__defineSetter__("longitude",function(a){c.GeoPoint._validate(f.latitude,a);f._longitude=a}))};c.GeoPoint._validate=function(b,a){if(-90>b)throw"Parse.GeoPoint latitude "+b+" < -90.0.";if(90<b)throw"Parse.GeoPoint latitude "+b+" > 90.0.";if(-180>a)throw"Parse.GeoPoint longitude "+
a+" < -180.0.";if(180<a)throw"Parse.GeoPoint longitude "+a+" > 180.0.";};c.GeoPoint.current=function(b){navigator.geolocation.getCurrentPosition(function(a){b.success&&b.success(new c.GeoPoint({latitude:a.coords.latitude,longitude:a.coords.longitude}))},function(a){b.error&&b.error(a)})};c.GeoPoint.prototype={toJSON:function(){return c.GeoPoint._validate(this.latitude,this.longitude),{__type:"GeoPoint",latitude:this.latitude,longitude:this.longitude}},radiansTo:function(b){var a=Math.PI/180,c=this.latitude*
a,h=b.latitude*a,a=this.longitude*a-b.longitude*a,b=Math.sin((c-h)/2),a=Math.sin(a/2),c=b*b+Math.cos(c)*Math.cos(h)*a*a;return c=Math.min(1,c),2*Math.asin(Math.sqrt(c))},kilometersTo:function(b){return 6371*this.radiansTo(b)},milesTo:function(b){return 3958.8*this.radiansTo(b)}}})(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse,e=c._;c.ACL=function(b){var a=this;a.permissionsById={};if(e.isObject(b))if(b instanceof c.User)a.setReadAccess(b,!0),a.setWriteAccess(b,!0);else{if(e.isFunction(b))throw"Parse.ACL() called with a function.  Did you forget ()?";c._each(b,function(b,h){if(!e.isString(h))throw"Tried to create an ACL with an invalid userId.";a.permissionsById[h]={};c._each(b,function(b,c){if("read"!==c&&"write"!==c)throw"Tried to create an ACL with an invalid permission type.";
if(!e.isBoolean(b))throw"Tried to create an ACL with an invalid permission value.";a.permissionsById[h][c]=b})})}};c.ACL.prototype.toJSON=function(){return e.clone(this.permissionsById)};c.ACL.prototype._setAccess=function(b,a,f){a instanceof c.User?a=a.id:a instanceof c.Role&&(a="role:"+a.getName());if(!e.isString(a))throw"userId must be a string.";if(!e.isBoolean(f))throw"allowed must be either true or false.";var h=this.permissionsById[a];if(!h){if(!f)return;h={};this.permissionsById[a]=h}f?this.permissionsById[a][b]=
!0:(delete h[b],e.isEmpty(h)&&delete h[a])};c.ACL.prototype._getAccess=function(b,a){a instanceof c.User?a=a.id:a instanceof c.Role&&(a="role:"+a.getName());var f=this.permissionsById[a];return f?f[b]?!0:!1:!1};c.ACL.prototype.setReadAccess=function(b,a){this._setAccess("read",b,a)};c.ACL.prototype.getReadAccess=function(b){return this._getAccess("read",b)};c.ACL.prototype.setWriteAccess=function(b,a){this._setAccess("write",b,a)};c.ACL.prototype.getWriteAccess=function(b){return this._getAccess("write",
b)};c.ACL.prototype.setPublicReadAccess=function(b){this.setReadAccess("*",b)};c.ACL.prototype.getPublicReadAccess=function(){return this.getReadAccess("*")};c.ACL.prototype.setPublicWriteAccess=function(b){this.setWriteAccess("*",b)};c.ACL.prototype.getPublicWriteAccess=function(){return this.getWriteAccess("*")};c.ACL.prototype.getRoleReadAccess=function(b){b instanceof c.Role&&(b=b.getName());if(e.isString(b))return this.getReadAccess("role:"+b);throw"role must be a Parse.Role or a String";};c.ACL.prototype.getRoleWriteAccess=
function(b){b instanceof c.Role&&(b=b.getName());if(e.isString(b))return this.getWriteAccess("role:"+b);throw"role must be a Parse.Role or a String";};c.ACL.prototype.setRoleReadAccess=function(b,a){b instanceof c.Role&&(b=b.getName());if(e.isString(b))this.setReadAccess("role:"+b,a);else throw"role must be a Parse.Role or a String";};c.ACL.prototype.setRoleWriteAccess=function(b,a){b instanceof c.Role&&(b=b.getName());if(e.isString(b))this.setWriteAccess("role:"+b,a);else throw"role must be a Parse.Role or a String";
}})(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse,e=c._;c.Op=function(){this._initialize.apply(this,arguments)};c.Op.prototype={_initialize:function(){}};e.extend(c.Op,{_extend:c._extend,_opDecoderMap:{},_registerDecoder:function(b,a){c.Op._opDecoderMap[b]=a},_decode:function(b){var a=c.Op._opDecoderMap[b.__op];return a?a(b):void 0}});c.Op._registerDecoder("Batch",function(b){var a=null;return e.each(b.ops,function(b){b=c.Op._decode(b);a=b._mergeWithPrevious(a)}),a});c.Op.Set=c.Op._extend({_initialize:function(b){this._value=b},
value:function(){return this._value},toJSON:function(){return c._encode(this.value())},_mergeWithPrevious:function(){return this},_estimate:function(){return this.value()}});c.Op._UNSET={};c.Op.Unset=c.Op._extend({toJSON:function(){return{__op:"Delete"}},_mergeWithPrevious:function(){return this},_estimate:function(){return c.Op._UNSET}});c.Op._registerDecoder("Delete",function(){return new c.Op.Unset});c.Op.Increment=c.Op._extend({_initialize:function(b){this._amount=b},amount:function(){return this._amount},
toJSON:function(){return{__op:"Increment",amount:this._amount}},_mergeWithPrevious:function(b){if(!b)return this;if(b instanceof c.Op.Unset)return new c.Op.Set(this.amount());if(b instanceof c.Op.Set)return new c.Op.Set(b.value()+this.amount());if(b instanceof c.Op.Increment)return new c.Op.Increment(this.amount()+b.amount());throw"Op is invalid after previous op.";},_estimate:function(b){return b?b+this.amount():this.amount()}});c.Op._registerDecoder("Increment",function(b){return new c.Op.Increment(b.amount)});
c.Op.Add=c.Op._extend({_initialize:function(b){this._objects=b},objects:function(){return this._objects},toJSON:function(){return{__op:"Add",objects:this.objects()}},_mergeWithPrevious:function(b){if(!b)return this;if(b instanceof c.Op.Unset)return new c.Op.Set(this.objects());if(b instanceof c.Op.Set)return new c.Op.Set(this._estimate(b.value()));if(b instanceof c.Op.Add)return new c.Op.Add(b.objects().concat(this.objects()));throw"Op is invalid after previous op.";},_estimate:function(b){return b?
b.concat(this.objects()):e.clone(this.objects())}});c.Op._registerDecoder("Add",function(b){return new c.Op.Add(c._decode(b.objects))});c.Op.AddUnique=c.Op._extend({_initialize:function(b){this._objects=e.uniq(b)},objects:function(){return this._objects},toJSON:function(){return{__op:"AddUnique",objects:this.objects()}},_mergeWithPrevious:function(b){if(!b)return this;if(b instanceof c.Op.Unset)return new c.Op.Set(this.objects());if(b instanceof c.Op.Set)return new c.Op.Set(this._estimate(b.value()));
if(b instanceof c.Op.AddUnique)return new c.Op.AddUnique(e.union(b.objects(),this.objects()));throw"Op is invalid after previous op.";},_estimate:function(b){return b?b.concat(e.difference(this.objects(),b)):e.clone(this.objects())}});c.Op._registerDecoder("AddUnique",function(b){return new c.Op.AddUnique(c._decode(b.objects))});c.Op.Remove=c.Op._extend({_initialize:function(b){this._objects=e.uniq(b)},objects:function(){return this._objects},toJSON:function(){return{__op:"Remove",objects:this.objects()}},
_mergeWithPrevious:function(b){if(!b)return this;if(b instanceof c.Op.Unset)return b;if(b instanceof c.Op.Set)return new c.Op.Set(this._estimate(b.value()));if(b instanceof c.Op.Remove)return new c.Op.Remove(e.union(b.objects(),this.objects()));throw"Op is invalid after previous op.";},_estimate:function(b){return b?e.difference(b,this.objects()):[]}});c.Op._registerDecoder("Remove",function(b){return new c.Op.Remove(c._decode(b.objects))});c.Op.Relation=c.Op._extend({_initialize:function(b,a){this._targetClassName=
null;var f=this,h=function(a){if(a instanceof c.Object){if(!a.id)throw"You can't add an unsaved Parse.Object to a relation.";f._targetClassName||(f._targetClassName=a.className);if(f._targetClassName!==a.className)throw"Tried to create a Parse.Relation with 2 different types: "+f._targetClassName+" and "+a.className+".";return a.id}return a};this.relationsToAdd=e.uniq(e.map(b,h));this.relationsToRemove=e.uniq(e.map(a,h))},added:function(){var b=this;return e.map(this.relationsToAdd,function(a){var f=
c.Object._create(b._targetClassName);return f.id=a,f})},removed:function(){var b=this;return e.map(this.relationsToRemove,function(a){var f=c.Object._create(b._targetClassName);return f.id=a,f})},toJSON:function(){var b=null,a=null,c=this,h=function(a){return{__type:"Pointer",className:c._targetClassName,objectId:a}},d=null;return 0<this.relationsToAdd.length&&(d=e.map(this.relationsToAdd,h),b={__op:"AddRelation",objects:d}),0<this.relationsToRemove.length&&(d=e.map(this.relationsToRemove,h),a={__op:"RemoveRelation",
objects:d}),b&&a?{__op:"Batch",ops:[b,a]}:b||a||{}},_mergeWithPrevious:function(b){if(!b)return this;if(b instanceof c.Op.Unset)throw"You can't modify a relation after deleting it.";if(b instanceof c.Op.Relation){if(b._targetClassName&&b._targetClassName!==this._targetClassName)throw"Related object must be of class "+b._targetClassName+", but "+this._targetClassName+" was passed in.";var a=e.union(e.difference(b.relationsToAdd,this.relationsToRemove),this.relationsToAdd),b=e.union(e.difference(b.relationsToRemove,
this.relationsToAdd),this.relationsToRemove),a=new c.Op.Relation(a,b);return a._targetClassName=this._targetClassName,a}throw"Op is invalid after previous op.";},_estimate:function(b,a,f){if(b){if(b instanceof c.Relation){if(this._targetClassName)if(b.targetClassName){if(b.targetClassName!==this._targetClassName)throw"Related object must be a "+b.targetClassName+", but a "+this._targetClassName+" was passed in.";}else b.targetClassName=this._targetClassName;return b}throw"Op is invalid after previous op.";
}(new c.Relation(a,f)).targetClassName=this._targetClassName}});c.Op._registerDecoder("AddRelation",function(b){return new c.Op.Relation(b.objects,[])});c.Op._registerDecoder("RemoveRelation",function(b){return new c.Op.Relation([],b.objects)})})(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse,e=c._;c.Relation=function(b,a){this.parent=b;this.key=a;this.targetClassName=null};c.Relation.prototype={_ensureParentAndKey:function(b,a){this.parent=this.parent||b;this.key=this.key||a;if(this.parent!==b)throw"Internal Error. Relation retrieved from two different Objects.";if(this.key!==a)throw"Internal Error. Relation retrieved from two different keys.";},add:function(b){e.isArray(b)||(b=[b]);b=new c.Op.Relation(b,[]);this.parent.set(this.key,b);this.targetClassName=
b._targetClassName},remove:function(b){e.isArray(b)||(b=[b]);b=new c.Op.Relation([],b);this.parent.set(this.key,b);this.targetClassName=b._targetClassName},toJSON:function(){return{__type:"Relation",className:this.targetClassName}},query:function(){var b=c.Object._getSubclass(this.targetClassName),b=new c.Query(b);return b._addCondition("$relatedTo","object",this.parent._toPointer()),b._addCondition("$relatedTo","key",this.key),b}}})(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse,e=c._;c.Object=function(a,b){if(e.isString(a))return c.Object._create.apply(this,arguments);a=a||{};b&&b.parse&&(a=this.parse(a));var h=c._getValue(this,"defaults");h&&(a=e.extend({},h,a));b&&b.collection&&(this.collection=b.collection);this._serverData={};this._opSetQueue=[{}];this.attributes={};this._hashedJSON={};this._escapedAttributes={};this.cid=e.uniqueId("c");this.changed={};this._silent={};this._pending={};if(!this.set(a,{silent:!0}))throw Error("Can't create an invalid Parse.Object");
this.changed={};this._silent={};this._pending={};this._hasData=!0;this._previousAttributes=e.clone(this.attributes);this.initialize.apply(this,arguments)};var b=function(a,c,h,d){var h=h||[],k;k=e.isFunction(d)?{success:function(a){d(a,null)},error:function(a){d(null,a)}}:d;if(a.length){var j=k?e.clone(k):{};j.success=function(d){h.push(d);b(e.rest(a),c,h,k)};c.call(this,e.first(a),j)}else k.success&&k.success(h)};c.Object.saveAll=function(a,c){b(a,function(a,b){a.save(null,b)},[],c)};c.Object._signUpAll=
function(a,c){b(a,function(a,b){a.signUp(null,b)},[],c)};e.extend(c.Object.prototype,c.Events,{_existed:!1,initialize:function(){},toJSON:function(){var a=this._toFullJSON();return e.each(["createdAt","objectId","updatedAt","__type","className"],function(b){delete a[b]}),a},_toFullJSON:function(a){var b=e.clone(this.attributes);return c._each(b,function(h,d){b[d]=c._encode(h,a)}),c._each(this._operations,function(a,c){b[c]=a}),b.objectId=this.id,b.createdAt=this.createdAt,b.updatedAt=this.updatedAt,
b.__type="Object",b.className=this.className,b},_refreshCache:function(){var a=this;c._each(this.attributes,function(b,h){b instanceof c.Object?b._refreshCache():e.isObject(b)&&a._resetCacheForKey(h)&&a.set(h,new c.Op.Set(b),{silent:!0})})},dirty:function(a){this._refreshCache();var b=e.last(this._opSetQueue);return a?b[a]?!0:!1:this.id?0<e.keys(b).length?!0:!1:!0},_toPointer:function(){if(!this.id)throw Error("Can't serialize an unsaved Parse.Object");return{__type:"Pointer",className:this.className,
objectId:this.id}},get:function(a){return this.attributes[a]},relation:function(a){var b=this.get(a);if(b){if(b instanceof c.Relation)return b._ensureParentAndKey(this,a),b;throw"Called relation() on non-relation field "+a;}return new c.Relation(this,a)},escape:function(a){var b=this._escapedAttributes[a];if(b)return b;var b=this.attributes[a],h;return c._isNullOrUndefined(b)?h="":h=e.escape(b.toString()),this._escapedAttributes[a]=h,h},has:function(a){return!c._isNullOrUndefined(this.attributes[a])},
_mergeMagicFields:function(a){var b=this;e.each(["id","objectId","createdAt","updatedAt"],function(c){a[c]&&("objectId"===c?b.id=a[c]:b[c]=a[c],delete a[c])})},_startSave:function(){this._opSetQueue.push({})},_processSaveQueue:function(){if(this._saveQueue&&0<this._saveQueue.length){var a=e.first(this._saveQueue);this._saveQueue=e.rest(this._saveQueue);a()}else this._saving=!1},_cancelSave:function(){var a=e.first(this._opSetQueue);this._opSetQueue=e.rest(this._opSetQueue);var b=e.first(this._opSetQueue);
c._each(a,function(c,d){var e=a[d],j=b[d];e&&j?b[d]=j._mergeWithPrevious(e):e&&(b[d]=e)});this._processSaveQueue()},_finishSave:function(a){var b=e.first(this._opSetQueue);this._opSetQueue=e.rest(this._opSetQueue);this._applyOpSet(b,this._serverData);this._mergeMagicFields(a);var h=this;c._each(a,function(a,b){h._serverData[b]=c._decode(b,a)});this._rebuildAllEstimatedData();this._processSaveQueue()},_finishFetch:function(a,b){this._mergeMagicFields(a);var h=this;c._each(a,function(a,b){h._serverData[b]=
c._decode(b,a)});this._refreshCache();this._hasData=b;this._opSetQueue=[{}];this._rebuildAllEstimatedData()},_applyOpSet:function(a,b){var h=this;c._.each(a,function(a,d){b[d]=a._estimate(b[d],h,d);b[d]===c.Op._UNSET&&delete b[d]})},_resetCacheForKey:function(a){var b=this.attributes[a];return e.isObject(b)&&!(b instanceof c.Object)&&(b=b.toJSON?b.toJSON():b,b=JSON.stringify(b),this._hashedJSON[a]!==b)?(this._hashedJSON[a]=b,!0):!1},_rebuildEstimatedDataForKey:function(a){var b=this;delete this.attributes[a];
this._serverData[a]&&(this.attributes[a]=this._serverData[a]);e.each(this._opSetQueue,function(h){(h=h[a])&&(b.attributes[a]=h._estimate(b.attributes[a],b,a),b.attributes[a]===c.Op._UNSET?delete b.attributes[a]:b._resetCacheForKey(a))})},_rebuildAllEstimatedData:function(){var a=this;this.attributes=e.clone(this._serverData);e.each(this._opSetQueue,function(b){a._applyOpSet(b,a.attributes);e.each(b,function(b,c){a._resetCacheForKey(c)})})},set:function(a,b,h){var d;e.isObject(a)||c._isNullOrUndefined(a)?
(d=a,c._each(d,function(a,b){d[b]=c._decode(b,a)}),h=b):(d={},d[a]=c._decode(a,b));h=h||{};if(!d)return this;d instanceof c.Object&&(d=d.attributes);h.unset&&c._each(d,function(a,b){d[b]=new c.Op.Unset});var k=e.clone(d),j=this;c._each(k,function(a,b){a instanceof c.Op&&(k[b]=a._estimate(j.attributes[b],j,b),k[b]===c.Op._UNSET&&delete k[b])});if(!this._validate(d,h))return!1;this._mergeMagicFields(d);h.changes={};var l=this._escapedAttributes;return c._each(e.keys(d),function(a){var b=d[a];b instanceof
c.Relation&&(b.parent=j);b instanceof c.Op||(b=new c.Op.Set(b));var f=!0;b instanceof c.Op.Set&&e.isEqual(j.attributes[a],b.value)&&(f=!1);f&&(delete l[a],h.silent?j._silent[a]=!0:h.changes[a]=!0);var k=e.last(j._opSetQueue);k[a]=b._mergeWithPrevious(k[a]);j._rebuildEstimatedDataForKey(a);f?(j.changed[a]=j.attributes[a],h.silent||(j._pending[a]=!0)):(delete j.changed[a],delete j._pending[a])}),h.silent||this.change(h),this},unset:function(a,b){return b=b||{},b.unset=!0,this.set(a,null,b)},increment:function(a,
b){if(e.isUndefined(b)||e.isNull(b))b=1;return this.set(a,new c.Op.Increment(b))},add:function(a,b){return this.set(a,new c.Op.Add([b]))},addUnique:function(a,b){return this.set(a,new c.Op.AddUnique([b]))},remove:function(a,b){return this.set(a,new c.Op.Remove([b]))},op:function(a){return e.last(this._opSetQueue)[a]},clear:function(a){a=a||{};a.unset=!0;var b=e.extend(this.attributes,this._operations);return this.set(b,a)},_getSaveJSON:function(){var a=e.clone(e.first(this._opSetQueue));return c._each(a,
function(b,c){a[c]=b.toJSON()}),a},fetch:function(a){var a=a?e.clone(a):{},b=this,d=a.success;a.success=function(a,c,e){b._finishFetch(b.parse(a,c,e),!0);d&&d(b,a)};a.error=c.Object._wrapError(a.error,b,a);c._request("classes",b.className,b.id,"GET",null,a)},save:function(a,b,d){var i,k,j;e.isObject(a)||c._isNullOrUndefined(a)?(i=a,j=b):(i={},i[a]=b,j=d);if(!j&&i&&0===e.reject(i,function(a,b){return e.include(["success","error","wait"],b)}).length&&(a=!0,e.has(i,"success")&&!e.isFunction(i.success)&&
(a=!1),e.has(i,"error")&&!e.isFunction(i.error)&&(a=!1),a))return this.save(null,i);j=j?e.clone(j):{};j.wait&&(k=e.clone(this.attributes));var l=e.extend({},j,{silent:!0});if(i&&!this.set(i,j.wait?l:j))return!1;var r=j,m=e.clone(j),s=this;s._refreshCache();a=c.Object._findUnsavedChildren(s.attributes);if(0<a.length)return c.Object.saveAll(a,{success:function(){s.save(null,r)},error:function(a){j.error&&j.error.apply(this,arguments)}}),this;m.success=function(a,b,c){b=s.parse(a,b,c);m.wait&&(b=e.extend(i||
{},b));s._finishSave(b);r.success?r.success(s,a):s.trigger("sync",s,a,m)};m.error=function(){s._cancelSave();r.error&&r.error.apply(this,arguments)};m.error=c.Object._wrapError(m.error,s,m);this._startSave();a=function(){var a=s.id?"PUT":"POST",b=s._getSaveJSON(),f="classes",d=s.className;"_User"===s.className&&!s.id&&(f="users",d=null);c._request(f,d,s.id,a,b,m);m.wait&&s.set(k,l)};return this._saving?(this._saveQueue=this._saveQueue||[],this._saveQueue.push(a)):(this._saving=!0,a()),this},destroy:function(a){var a=
a?e.clone(a):{},b=this,d=a.success,i=function(){b.trigger("destroy",b,b.collection,a)};if(!this.id)return i();a.success=function(c){a.wait&&i();d?d(b,c):b.trigger("sync",b,c,a)};a.error=c.Object._wrapError(a.error,b,a);c._request("classes",this.className,this.id,"DELETE",null,a);a.wait||i()},parse:function(a,b){var d=e.clone(a);return e(["createdAt","updatedAt"]).each(function(a){d[a]&&(d[a]=c._parseDate(d[a]))}),d.updatedAt||(d.updatedAt=d.createdAt),b&&(this._existed=201!==b.status),d},clone:function(){return new this.constructor(this.attributes)},
isNew:function(){return!this.id},change:function(a){var a=a||{},b=this._changing;this._changing=!0;var d=this;c._each(this._silent,function(a){d._pending[a]=!0});var i=e.extend({},a.changes,this._silent);this._silent={};c._each(i,function(b){d.trigger("change:"+b,d,d.get(b),a)});if(b)return this;for(b=function(a){!d._pending[a]&&!d._silent[a]&&delete d.changed[a]};!e.isEmpty(this._pending);)this._pending={},this.trigger("change",this,a),c._each(this.changed,b),d._previousAttributes=e.clone(this.attributes);
return this._changing=!1,this},existed:function(){return this._existed},hasChanged:function(a){return arguments.length?this._changed&&e.has(this._changed,a):!e.isEmpty(this._changed)},changedAttributes:function(a){if(!a)return this.hasChanged()?e.clone(this._changed):!1;var b={},d=this._previousAttributes;return c._each(a,function(a,c){e.isEqual(d[c],a)||(b[c]=a)}),b},previous:function(a){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return e.clone(this._previousAttributes)},
isValid:function(){return!this.validate(this.attributes)},validate:function(a){return!e.has(a,"ACL")||a.ACL instanceof c.ACL?!1:new c.Error(c.Error.OTHER_CAUSE,"ACL must be a Parse.ACL.")},_validate:function(a,b){if(b.silent||!this.validate)return!0;var a=e.extend({},this.attributes,a),c=this.validate(a,b);return c?(b&&b.error?b.error(this,c,b):this.trigger("error",this,c,b),!1):!0},getACL:function(){return this.get("ACL")},setACL:function(a,b){return this.set("ACL",a,b)}});c.Object._getSubclass=
function(a){if(!e.isString(a))throw"Parse.Object._getSubclass requires a string argument.";var b=c.Object._classMap[a];return b||(b=c.Object.extend(a),c.Object._classMap[a]=b),b};c.Object._create=function(a,b,d){return new (c.Object._getSubclass(a))(b,d)};c.Object._classMap={};c.Object._extend=c._extend;c.Object.extend=function(a,b,d){if(!e.isString(a)){if(a&&e.has(a,"className"))return c.Object.extend(a.className,a,b);throw Error("Parse.Object.extend's first argument should be the className.");}"User"===
a&&(a="_User");var i=null;e.has(c.Object._classMap,a)?i=c.Object._classMap[a]._extend(b,d):(b=b||{},b.className=a,i=c.Object._extend(b,d));return i.extend=function(b){if(e.isString(b)||b&&e.has(b,"className"))return c.Object.extend.apply(i,arguments);var f=[a].concat(c._.toArray(arguments));return c.Object.extend.apply(i,f)},c.Object._classMap[a]=i,i};c.Object._wrapError=function(a,b,d){return function(e,k){e!==b&&(k=e);var j=new c.Error(-1,k.responseText);if(k.responseText){var l=JSON.parse(k.responseText);
l&&(j=new c.Error(l.code,l.error))}a?a(b,j,d):b.trigger("error",b,j,d)}};c.Object._findUnsavedChildren=function(a){var b=[];a instanceof c.Object?(a._refreshCache(),a.dirty()&&(b=[a]),b.push.apply(b,c.Object._findUnsavedChildren(a.attributes))):a instanceof c.Relation||(e.isArray(a)?e.each(a,function(a){b.push.apply(b,c.Object._findUnsavedChildren(a))}):e.isObject(a)&&c._each(a,function(a){b.push.apply(b,c.Object._findUnsavedChildren(a))}));return b}})(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse,e=c._;c.Role=c.Object.extend("_Role",{constructor:function(b,a){e.isString(b)&&a instanceof c.ACL?(c.Object.prototype.constructor.call(this,null,null),this.setName(b),this.setACL(a)):c.Object.prototype.constructor.call(this,b,a)},getName:function(){return this.get("name")},setName:function(b,a){return this.set("name",b,a)},getUsers:function(){return this.relation("users")},getRoles:function(){return this.relation("roles")},validate:function(b,a){if("name"in
b&&b.name!==this.getName()){var f=b.name;if(this.id&&this.id!==b.objectId)return new c.Error(c.Error.OTHER_CAUSE,"A role's name can only be set before it has been saved.");if(!e.isString(f))return new c.Error(c.Error.OTHER_CAUSE,"A role's name must be a String.");if(!/^[a-zA-Z\-_ ]+$/.test(f))return new c.Error(c.Error.OTHER_CAUSE,"A role's name can only contain alphanumeric characters, _, -, and spaces.")}return c.Object.prototype.validate?c.Object.prototype.validate.call(this,b,a):!1}})})(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse,e=c._;c.Collection=function(b,a){a=a||{};a.comparator&&(this.comparator=a.comparator);a.model&&(this.model=a.model);a.query&&(this.query=a.query);this._reset();this.initialize.apply(this,arguments);b&&this.reset(b,{silent:!0,parse:a.parse})};e.extend(c.Collection.prototype,c.Events,{model:c.Object,initialize:function(){},toJSON:function(){return this.map(function(b){return b.toJSON()})},add:function(b,a){var f,d,i,k,j,l={},r={},a=a||{},b=e.isArray(b)?
b.slice():[b];f=0;for(d=b.length;f<d;f++){b[f]=this._prepareModel(b[f],a);i=b[f];if(!i)throw Error("Can't add an invalid model to a collection");k=i.cid;if(l[k]||this._byCid[k])throw Error("Duplicate cid: can't add the same model to a collection twice");j=i.id;if(!c._isNullOrUndefined(j)&&(r[j]||this._byId[j]))throw Error("Duplicate id: can't add the same model to a collection twice");r[j]=i;l[k]=i}for(f=0;f<d;f++)(i=b[f]).on("all",this._onModelEvent,this),this._byCid[i.cid]=i,i.id&&(this._byId[i.id]=
i);this.length+=d;this.models.splice.apply(this.models,[a.at||this.models.length,0].concat(b));this.comparator&&this.sort({silent:!0});if(a.silent)return this;f=0;for(d=this.models.length;f<d;f++)i=this.models[f],l[i.cid]&&(a.index=f,i.trigger("add",i,this,a));return this},remove:function(b,a){var c,d,i,k,a=a||{},b=e.isArray(b)?b.slice():[b];c=0;for(d=b.length;c<d;c++)if(k=this.getByCid(b[c])||this.get(b[c]))delete this._byId[k.id],delete this._byCid[k.cid],i=this.indexOf(k),this.models.splice(i,
1),this.length--,a.silent||(a.index=i,k.trigger("remove",k,this,a)),this._removeReference(k);return this},get:function(b){return b&&this._byId[b.id||b]},getByCid:function(b){return b&&this._byCid[b.cid||b]},at:function(b){return this.models[b]},sort:function(b){b=b||{};if(!this.comparator)throw Error("Cannot sort a set without a comparator");var a=e.bind(this.comparator,this);return 1===this.comparator.length?this.models=this.sortBy(a):this.models.sort(a),b.silent||this.trigger("reset",this,b),this},
pluck:function(b){return e.map(this.models,function(a){return a.get(b)})},reset:function(b,a){var c=this;return b=b||[],a=a||{},e.each(this.models,function(a){c._removeReference(a)}),this._reset(),this.add(b,{silent:!0,parse:a.parse}),a.silent||this.trigger("reset",this,a),this},fetch:function(b){b=b?e.clone(b):{};void 0===b.parse&&(b.parse=!0);var a=this,f=b.success;b.success=function(c,d){b.add?a.add(c,b):a.reset(c,b);f&&f(a,d)};b.error=c.Object._wrapError(b.error,a,b);(this.query||new c.Query(this.model)).find(b)},
create:function(b,a){var c=this,a=a?e.clone(a):{},b=this._prepareModel(b,a);if(!b)return!1;a.wait||c.add(b,a);var d=a.success;return a.success=function(e,k){a.wait&&c.add(e,a);d?d(e,k):e.trigger("sync",b,k,a)},b.save(null,a),b},parse:function(b){return b},chain:function(){return e(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(b,a){b instanceof c.Object?b.collection||(b.collection=this):(a.collection=this,b=new this.model(b,
a),b._validate(b.attributes,a)||(b=!1));return b},_removeReference:function(b){this===b.collection&&delete b.collection;b.off("all",this._onModelEvent,this)},_onModelEvent:function(b,a,c,d){if("add"!==b&&"remove"!==b||c===this)"destroy"===b&&this.remove(a,d),a&&"change:objectId"===b&&(delete this._byId[a.previous("objectId")],this._byId[a.id]=a),this.trigger.apply(this,arguments)}});e.each("forEach each map reduce reduceRight find detect filter select reject every all some any include contains invoke max min sortBy sortedIndex toArray size first initial rest last without indexOf shuffle lastIndexOf isEmpty groupBy".split(" "),
function(b){c.Collection.prototype[b]=function(){return e[b].apply(e,[this.models].concat(e.toArray(arguments)))}});c.Collection.extend=c._extend})(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse,e=c._;c.View=function(a){this.cid=e.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var b=/^(\S+)\s*(.*)$/,a="model collection el id attributes className tagName".split(" ");e.extend(c.View.prototype,c.Events,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(a,
b,d){a=document.createElement(a);return b&&c.$(a).attr(b),d&&c.$(a).html(d),a},setElement:function(a,b){return this.$el=c.$(a),this.el=this.$el[0],!1!==b&&this.delegateEvents(),this},delegateEvents:function(a){if(a=a||c._getValue(this,"events")){this.undelegateEvents();var d=this;c._each(a,function(c,k){e.isFunction(c)||(c=d[a[k]]);if(!c)throw Error('Event "'+a[k]+'" does not exist');var j=k.match(b),l=j[1],j=j[2],c=e.bind(c,d),l=l+(".delegateEvents"+d.cid);""===j?d.$el.bind(l,c):d.$el.delegate(j,
l,c)})}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(b){this.options&&(b=e.extend({},this.options,b));var c=this;e.each(a,function(a){b[a]&&(c[a]=b[a])});this.options=b},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var a=c._getValue(this,"attributes")||{};this.id&&(a.id=this.id);this.className&&(a["class"]=this.className);this.setElement(this.make(this.tagName,a),!1)}}});c.View.extend=c._extend})(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse,e=c._;c.User=c.Object.extend("_User",{_isCurrentUser:!1,_mergeMagicFields:function(b){b.sessionToken&&(this._sessionToken=b.sessionToken,delete b.sessionToken);c.User.__super__._mergeMagicFields.call(this,b)},_cleanupAuthData:function(){if(this.isCurrent()){var b=this.get("authData");b&&e.each(this.get("authData"),function(a,c){b[c]||delete b[c]})}},_synchronizeAllAuthData:function(){if(this.get("authData")){var b=this;e.each(this.get("authData"),function(a,
c){b._synchronizeAuthData(c)})}},_synchronizeAuthData:function(b){if(this.isCurrent()){var a;e.isString(b)?(a=b,b=c.User._authProviders[a]):a=b.getAuthType();var f=this.get("authData");f&&b&&(b.restoreAuthentication(f[a])||this._unlinkFrom(b))}},_handleSaveResult:function(b){b&&(this._isCurrentUser=!0);this._cleanupAuthData();this._synchronizeAllAuthData();delete this._serverData.password;this._rebuildEstimatedDataForKey("password");this._refreshCache();(b||this.isCurrent())&&c.User._saveCurrentUser(this)},
_linkWith:function(b,a){var f;e.isString(b)?(f=b,b=c.User._authProviders[b]):f=b.getAuthType();if(e.has(a,"authData")){var d=this.get("authData")||{};d[f]=a.authData;this.set("authData",d);f=e.clone(a);return f.success=function(b){b._handleSaveResult(!0);a.success&&a.success.apply(this,arguments)},this.save({authData:d},f)}var i=this;return b.authenticate({success:function(b,c){i._linkWith(b,{authData:c,success:a.success,error:a.error})},error:function(b,c){a.error&&a.error(i,c)}})},_unlinkFrom:function(b,
a){e.isString(b)?b=c.User._authProviders[b]:b.getAuthType();var f=e.clone(a),d=this;return f.authData=null,f.success=function(c){d._synchronizeAuthData(b);a.success&&a.success.apply(this,arguments)},this._linkWith(b,f)},_isLinked:function(b){var a;e.isString(b)?a=b:a=b.getAuthType();return!!(this.get("authData")||{})[a]},_logOutWithAll:function(){if(this.get("authData")){var b=this;e.each(this.get("authData"),function(a,c){b._logOutWith(c)})}},_logOutWith:function(b){this.isCurrent()&&(e.isString(b)&&
(b=c.User._authProviders[b]),b&&b.deauthenticate&&b.deauthenticate())},signUp:function(b,a){var f,d=b&&b.username||this.get("username");if(!d||""===d)return a&&a.error&&(f=new c.Error(c.Error.OTHER_CAUSE,"Cannot sign up user with an empty name."),a.error(this,f)),!1;d=b&&b.password||this.get("password");if(!d||""===d)return a&&a.error&&(f=new c.Error(c.Error.OTHER_CAUSE,"Cannot sign up user with an empty password."),a.error(this,f)),!1;f=e.clone(a);return f.success=function(b){b._handleSaveResult(!0);
a.success&&a.success.apply(this,arguments)},this.save(b,f)},logIn:function(b){var a=this,d=e.clone(b);d.success=function(c,e,k){e=a.parse(c,e,k);a._finishFetch(e);a._handleSaveResult(!0);b.success?b.success(a,c):a.trigger("sync",a,c,d)};d.error=c.Object._wrapError(b.error,a,d);c._request("login",null,null,"GET",this.toJSON(),d)},save:function(b,a,d){var h,i;e.isObject(b)||e.isNull(b)||e.isUndefined(b)?(h=b,i=a):(h={},h[b]=a,i=d);b=e.clone(i);return b.success=function(a){a._handleSaveResult(!1);i.success&&
i.success.apply(this,arguments)},c.Object.prototype.save.call(this,h,b)},fetch:function(b){var a=e.clone(b);return a.success=function(a){a._handleSaveResult(!1);b.success&&b.success.apply(this,arguments)},c.Object.prototype.fetch.call(this,a)},isCurrent:function(){return this._isCurrentUser},getUsername:function(){return this.get("username")},setUsername:function(b,a){return this.set("username",b,a)},setPassword:function(b,a){return this.set("password",b,a)},getEmail:function(){return this.get("email")},
setEmail:function(b,a){return this.set("email",b,a)}},{_currentUser:null,_currentUserMatchesDisk:!1,_CURRENT_USER_KEY:"currentUser",_authProviders:{},signUp:function(b,a,d,h){d=d||{};d.username=b;d.password=a;return c.Object._create("_User").signUp(d,h)},logIn:function(b,a,d){var h=c.Object._create("_User");h._finishFetch({username:b,password:a});h.logIn(d)},logOut:function(){null!==c.User._currentUser&&(c.User._currentUser._logOutWithAll(),c.User._currentUser._isCurrentUser=!1);c.User._currentUserMatchesDisk=
!0;c.User._currentUser=null;localStorage.removeItem(c._getParsePath(c.User._CURRENT_USER_KEY))},requestPasswordReset:function(b,a){var d={email:b};a.error=c.Query._wrapError(a.error,a);c._request("requestPasswordReset",null,null,"POST",d,a)},current:function(){if(c.User._currentUser||c.User._currentUserMatchesDisk)return c.User._currentUser;c.User._currentUserMatchesDisk=!0;var b=localStorage.getItem(c._getParsePath(c.User._CURRENT_USER_KEY));if(!b)return null;c.User._currentUser=new c.Object._create("_User");
c.User._currentUser._isCurrentUser=!0;b=JSON.parse(b);return c.User._currentUser.id=b._id,delete b._id,c.User._currentUser._sessionToken=b._sessionToken,delete b._sessionToken,c.User._currentUser.set(b),c.User._currentUser._synchronizeAllAuthData(),c.User._currentUser._refreshCache(),c.User._currentUser._dirty={},c.User._currentUser},_saveCurrentUser:function(b){c.User._currentUser!==b&&c.User.logOut();b._isCurrentUser=!0;c.User._currentUser=b;c.User._currentUserMatchesDisk=!0;var a=b.toJSON();a._id=
b.id;a._sessionToken=b._sessionToken;localStorage.setItem(c._getParsePath(c.User._CURRENT_USER_KEY),JSON.stringify(a))},_registerAuthenticationProvider:function(b){c.User._authProviders[b.getAuthType()]=b;c.User.current()&&c.User.current()._synchronizeAuthData(b.getAuthType())},_logInWith:function(b,a){return(new c.User)._linkWith(b,a)}})})(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse,e=c._;c.Query=function(b){e.isString(b)&&(b=c.Object._getSubclass(b));this.objectClass=b;this.className=b.prototype.className;this._where={};this._include=[];this._limit=-1;this._skip=0};c.Query.prototype={get:function(b,a){var d=a.success||function(){},h=a.error||function(){};this.equalTo("objectId",b);this.first({error:function(a){h(null,a)},success:function(a){a?d(a):h(null,new c.Error(c.Error.OBJECT_NOT_FOUND,"Object not found."))}})},toJSON:function(){var b=
{where:this._where};return 0<this._include.length&&(b.include=this._include.join(",")),0<=this._limit&&(b.limit=this._limit),0<this._skip&&(b.skip=this._skip),void 0!==this._order&&(b.order=this._order),b},find:function(b){var a=this,d=b.success||function(){},h={error:b.error,success:function(b){d(e.map(b.results,function(b){var c=new a.objectClass;return c._finishFetch(b,!0),c}))}},i=this.toJSON();h.error=c.Query._wrapError(b.error,h);c._request("classes",this.className,null,"GET",i,h)},count:function(b){var a=
b.success||function(){},d={error:b.error,success:function(b){a(b.count)}},h=this.toJSON();h.limit=0;h.count=1;d.error=c.Query._wrapError(b.error,d);c._request("classes",this.className,null,"GET",h,d)},first:function(b){var a=this,d=b.success||function(){},h={error:b.error,success:function(b){d(e.map(b.results,function(b){var c=new a.objectClass;return c._finishFetch(b,!0),c})[0])}},i=this.toJSON();i.limit=1;h.error=c.Query._wrapError(b.error,h);c._request("classes",this.className,null,"GET",i,h)},
collection:function(b,a){return a=a||{},new c.Collection(b,e.extend(a,{model:this.objectClass,query:this}))},skip:function(b){return this._skip=b,this},limit:function(b){return this._limit=b,this},equalTo:function(b,a){return this._where[b]=c._encode(a),this},_addCondition:function(b,a,d){return this._where[b]||(this._where[b]={}),this._where[b][a]=c._encode(d),this},notEqualTo:function(b,a){return this._addCondition(b,"$ne",a),this},lessThan:function(b,a){return this._addCondition(b,"$lt",a),this},
greaterThan:function(b,a){return this._addCondition(b,"$gt",a),this},lessThanOrEqualTo:function(b,a){return this._addCondition(b,"$lte",a),this},greaterThanOrEqualTo:function(b,a){return this._addCondition(b,"$gte",a),this},containedIn:function(b,a){return this._addCondition(b,"$in",a),this},notContainedIn:function(b,a){return this._addCondition(b,"$nin",a),this},exists:function(b){return this._addCondition(b,"$exists",!0),this},doesNotExist:function(b){return this._addCondition(b,"$exists",!1),this},
matches:function(b,a,c){return this._addCondition(b,"$regex",a),c||(c=""),a.ignoreCase&&(c+="i"),a.multiline&&(c+="m"),c&&c.length&&this._addCondition(b,"$options",c),this},matchesQuery:function(b,a){var c=a.toJSON();return c.className=a.className,this._addCondition(b,"$inQuery",c),this},doesNotMatchQuery:function(b,a){var c=a.toJSON();return c.className=a.className,this._addCondition(b,"$notInQuery",c),this},matchesKeyInQuery:function(b,a,c){var d=c.toJSON();return d.className=c.className,this._addCondition(b,
"$select",{key:a,query:d}),this},_quote:function(b){return"\\Q"+b.replace("\\E","\\E\\\\E\\Q")+"\\E"},contains:function(b,a){return this._addCondition(b,"$regex",this._quote(a)),this},startsWith:function(b,a){return this._addCondition(b,"$regex","^"+this._quote(a)),this},endsWith:function(b,a){return this._addCondition(b,"$regex",this._quote(a)+"$"),this},ascending:function(b){return this._order=b,this},descending:function(b){return this._order="-"+b,this},near:function(b,a){return a instanceof c.GeoPoint||
(a=new c.GeoPoint(a)),this._addCondition(b,"$nearSphere",a),this},withinRadians:function(b,a,c){return this.near(b,a),this._addCondition(b,"$maxDistance",c),this},withinMiles:function(b,a,c){return this.withinRadians(b,a,c/3958.8)},withinKilometers:function(b,a,c){return this.withinRadians(b,a,c/6371)},withinGeoBox:function(b,a,d){return a instanceof c.GeoPoint||(a=new c.GeoPoint(a)),d instanceof c.GeoPoint||(d=new c.GeoPoint(d)),this._addCondition(b,"$within",{$box:[a,d]}),this},include:function(b){return e.isArray(b)?
this._include=this._include.concat(b):this._include.push(b),this}};c.Query._wrapError=function(b,a){return function(d){if(b){var h=new c.Error(-1,d.responseText);d.responseText&&(d=JSON.parse(d.responseText))&&(h=new c.Error(d.code,d.error));b(h,a)}}}})(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse,e=!1,b,a={authenticate:function(a){var c=this;FB.login(function(b){b.authResponse?a.success&&a.success(c,{id:b.authResponse.userID,access_token:b.authResponse.accessToken,expiration_date:(new Date(1E3*b.authResponse.expiresIn+(new Date).getTime())).toJSON()}):a.error&&a.error(c,b)},{scope:b})},restoreAuthentication:function(a){var b;return a?b={userID:a.id,accessToken:a.access_token,expiresIn:(c._parseDate(a.expiration_date).getTime()-(new Date).getTime())/
1E3}:b={userID:null,accessToken:null,expiresIn:null},FB.Auth.setAuthResponse(b),a||FB.logout(),!0},getAuthType:function(){return"facebook"},deauthenticate:function(){this.restoreAuthentication(null)}};c.FacebookUtils={init:function(b){if("undefined"==typeof FB)throw"The Javascript Facebook SDK must be loaded before calling init.";FB.init(b);c.User._registerAuthenticationProvider(a);e=!0},isLinked:function(a){return a._isLinked("facebook")},logIn:function(a,d){if(!e)throw"You must initialize FacebookUtils before calling logIn.";
return b=a,c.User._logInWith("facebook",d)},link:function(a,c,d){if(!e)throw"You must initialize FacebookUtils before calling link.";return b=c,a._linkWith("facebook",d)},unlink:function(a,b){if(!e)throw"You must initialize FacebookUtils before calling unlink.";return a._unlinkFrom("facebook",b)}}})(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse,e=c._;c.History=function(){this.handlers=[];e.bindAll(this,"checkUrl")};var b=/^[#\/]/,a=/msie [\w.]+/;c.History.started=!1;e.extend(c.History.prototype,c.Events,{interval:50,getHash:function(a){return(a=(a?a.location:window.location).href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,d){if(c._isNullOrUndefined(a))if(this._hasPushState||d){var a=window.location.pathname,e=window.location.search;e&&(a+=e)}else a=this.getHash();return a.indexOf(this.options.root)||
(a=a.substr(this.options.root.length)),a.replace(b,"")},start:function(d){if(c.History.started)throw Error("Parse.history has already been started");c.History.started=!0;this.options=e.extend({},{root:"/"},this.options,d);this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);var d=this.getFragment(),h=document.documentMode;(h=a.exec(navigator.userAgent.toLowerCase())&&
(!h||7>=h))&&(this.iframe=c.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(d));this._hasPushState?c.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!h?c.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=window.setInterval(this.checkUrl,this.interval));this.fragment=d;d=window.location;h=d.pathname===this.options.root;if(this._wantsHashChange&&this._wantsPushState&&
!this._hasPushState&&!h)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&h&&d.hash&&(this.fragment=this.getHash().replace(b,""),window.history.replaceState({},document.title,d.protocol+"//"+d.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){c.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);window.clearInterval(this._checkUrlInterval);
c.History.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return e.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,d){if(!c.History.started)return!1;
if(!d||!0===d)d={trigger:d};var e=(a||"").replace(b,"");this.fragment!==e&&(this._hasPushState?(0!==e.indexOf(this.options.root)&&(e=this.options.root+e),this.fragment=e,window.history[d.replace?"replaceState":"pushState"]({},document.title,e)):this._wantsHashChange?(this.fragment=e,this._updateHash(window.location,e,d.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(d.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,d.replace))):window.location.assign(this.options.root+
a),d.trigger&&this.loadUrl(a))},_updateHash:function(a,b,c){c?(c=a.toString().replace(/(javascript:|#).*$/,""),a.replace(c+"#"+b)):a.hash=b}})})(this);
(function(d){d.Parse=d.Parse||{};var c=d.Parse,e=c._;c.Router=function(a){a=a||{};a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)};var b=/:\w+/g,a=/\*\w+/g,f=/[\-\[\]{}()+?.,\\\^\$\|#\s]/g;e.extend(c.Router.prototype,c.Events,{initialize:function(){},route:function(a,b,d){return c.history=c.history||new c.History,e.isRegExp(a)||(a=this._routeToRegExp(a)),d||(d=this[b]),c.history.route(a,e.bind(function(f){f=this._extractParameters(a,f);d&&d.apply(this,f);
this.trigger.apply(this,["route:"+b].concat(f));c.history.trigger("route",this,b,f)},this)),this},navigate:function(a,b){c.history.navigate(a,b)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)this.routes.hasOwnProperty(b)&&a.unshift([b,this.routes[b]]);b=0;for(var c=a.length;b<c;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(c){return c=c.replace(f,"\\$&").replace(b,"([^/]+)").replace(a,"(.*?)"),RegExp("^"+c+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});
c.Router.extend=c._extend})(this);(function(){L.Util.extend(L.LineUtil,{segmentsIntersect:function(d,c,e,b){return this._checkCounterclockwise(d,e,b)!==this._checkCounterclockwise(c,e,b)&&this._checkCounterclockwise(d,c,e)!==this._checkCounterclockwise(d,c,b)},_checkCounterclockwise:function(d,c,e){return(e.y-d.y)*(c.x-d.x)>(c.y-d.y)*(e.x-d.x)}});L.Polyline.include({intersects:function(){var d=this._originalPoints,c=d?d.length:0,e,b;if(this._tooFewPointsForIntersection())return!1;for(c-=1;3<=c;c--)if(e=d[c-1],b=d[c],this._lineSegmentsIntersectsRange(e,
b,c-2))return!0;return!1},newLatLngIntersects:function(d){return this._map?this.newPointIntersects(this._map.latLngToLayerPoint(d)):!1},newPointIntersects:function(d){var c=this._originalPoints,e=c?c.length:0,c=c?c[e-1]:null,e=e-2;return this._tooFewPointsForIntersection(1)?!1:this._lineSegmentsIntersectsRange(c,d,e)},_tooFewPointsForIntersection:function(d){var c=this._originalPoints,c=c?c.length:0;return c+=d||0,!this._originalPoints||3>=c},_lineSegmentsIntersectsRange:function(d,c,e,b){for(var a=
this._originalPoints,f,b=b||0,h=e;h>b;h--)if(e=a[h-1],f=a[h],L.LineUtil.segmentsIntersect(d,c,e,f))return!0;return!1}});L.Polygon.include({intersects:function(){var d,c=this._originalPoints,e,b,a,f;return this._tooFewPointsForIntersection()?!1:(d=L.Polyline.prototype.intersects.call(this),d?!0:(e=c.length,b=c[0],a=c[e-1],f=e-2,this._lineSegmentsIntersectsRange(a,b,f,1)))}});L.Handler.Draw=L.Handler.extend({includes:L.Mixin.Events,initialize:function(d,c){this._map=d;this._container=d._container;this._pane=
d._panes.overlayPane;c&&c.shapeOptions&&(c.shapeOptions=L.Util.extend({},this.options.shapeOptions,c.shapeOptions));L.Util.extend(this.options,c)},enable:function(){this.fire("activated");L.Handler.prototype.enable.call(this)},addHooks:function(){this._map&&(L.DomUtil.disableTextSelection(),this._label=L.DomUtil.create("div","leaflet-draw-label",this._pane),this._singleLineLabel=!1,L.DomEvent.addListener(window,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),
this._pane.removeChild(this._label),delete this._label,L.DomEvent.removeListener(window,"keyup",this._cancelDrawing))},_updateLabelText:function(d){d.subtext=d.subtext||"";0===d.subtext.length&&!this._singleLineLabel?(L.DomUtil.addClass(this._label,"leaflet-draw-label-single"),this._singleLineLabel=!0):0<d.subtext.length&&this._singleLineLabel&&(L.DomUtil.removeClass(this._label,"leaflet-draw-label-single"),this._singleLineLabel=!1);this._label.innerHTML=(0<d.subtext.length?'<span class="leaflet-draw-label-subtext">'+
d.subtext+"</span><br />":"")+"<span>"+d.text+"</span>"},_updateLabelPosition:function(d){L.DomUtil.setPosition(this._label,d)},_cancelDrawing:function(d){27===d.keyCode&&this.disable()}});L.Polyline.Draw=L.Handler.Draw.extend({Poly:L.Polyline,options:{allowIntersection:!0,drawError:{color:"#b00b00",message:"<strong>Error:</strong> shape edges cannot cross!",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,shapeOptions:{stroke:!0,
color:"#f06eaa",weight:4,opacity:0.5,fill:!1,clickable:!0}},initialize:function(d,c){c&&c.drawError&&(c.drawError=L.Util.extend({},this.options.drawError,c.drawError));L.Handler.Draw.prototype.initialize.call(this,d,c)},addHooks:function(){L.Handler.Draw.prototype.addHooks.call(this);this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._container.style.cursor="crosshair",this._updateLabelText(this._getLabelText()),
this._map.on("mousemove",this._onMouseMove,this).on("click",this._onClick,this))},removeHooks:function(){L.Handler.Draw.prototype.removeHooks.call(this);this._clearHideErrorTimeout();this._cleanUpShape();this._map.removeLayer(this._markerGroup);delete this._markerGroup;delete this._markers;this._map.removeLayer(this._poly);delete this._poly;this._clearGuides();this._container.style.cursor="";this._map.off("mousemove",this._onMouseMove).off("click",this._onClick)},_finishShape:function(){this._map.fire("draw:poly-created",
{poly:new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions)});this.disable()},_onMouseMove:function(d){var c=d.layerPoint,e=this._markers.length;this._currentLatLng=d.latlng;this._updateLabelPosition(c);0<e&&(this._updateLabelText(this._getLabelText()),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),c));L.DomEvent.preventDefault(d)},_onClick:function(d){d=d.latlng;0<this._markers.length&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(d)?
this._showErrorLabel():(this._errorShown&&this._hideErrorLabel(),this._markers.push(this._createMarker(d)),this._poly.addLatLng(d),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._updateMarkerHandler(),this._vertexAdded(d))},_updateMarkerHandler:function(){1<this._markers.length&&this._markers[this._markers.length-1].on("click",this._finishShape,this);2<this._markers.length&&this._markers[this._markers.length-2].off("click",this._finishShape)},_createMarker:function(d){d=new L.Marker(d,
{icon:this.options.icon});return this._markerGroup.addLayer(d),d},_drawGuide:function(d,c){var e=Math.floor(Math.sqrt(Math.pow(c.x-d.x,2)+Math.pow(c.y-d.y,2))),b,a,f;this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._pane));for(b=this.options.guidelineDistance;b<e;b+=this.options.guidelineDistance)a=b/e,a={x:Math.floor(d.x*(1-a)+a*c.x),y:Math.floor(d.y*(1-a)+a*c.y)},f=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),f.style.backgroundColor=
this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(f,a)},_updateGuideColor:function(d){if(this._guidesContainer)for(var c=0,e=this._guidesContainer.childNodes.length;c<e;c++)this._guidesContainer.childNodes[c].style.backgroundColor=d},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_updateLabelText:function(d){this._errorShown||L.Handler.Draw.prototype._updateLabelText.call(this,
d)},_getLabelText:function(){var d,c,e;return 0===this._markers.length?d={text:"Click to start drawing line."}:(c=this._measurementRunningTotal+this._currentLatLng.distanceTo(this._markers[this._markers.length-1].getLatLng()),e=1E3<c?(c/1E3).toFixed(2)+" km":Math.ceil(c)+" m",1===this._markers.length?d={text:"Click to continue drawing line.",subtext:e}:d={text:"Click last point to finish line.",subtext:e}),d},_showErrorLabel:function(){this._errorShown=!0;L.DomUtil.addClass(this._label,"leaflet-error-draw-label");
L.DomUtil.addClass(this._label,"leaflet-flash-anim");L.Handler.Draw.prototype._updateLabelText.call(this,{text:this.options.drawError.message});this._updateGuideColor(this.options.drawError.color);this._poly.setStyle({color:this.options.drawError.color});this._clearHideErrorTimeout();this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorLabel,this),this.options.drawError.timeout)},_hideErrorLabel:function(){this._errorShown=!1;this._clearHideErrorTimeout();L.DomUtil.removeClass(this._label,
"leaflet-error-draw-label");L.DomUtil.removeClass(this._label,"leaflet-flash-anim");this._updateLabelText(this._getLabelText());this._updateGuideColor(this.options.shapeOptions.color);this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_vertexAdded:function(d){1===this._markers.length?this._measurementRunningTotal=0:this._measurementRunningTotal+=d.distanceTo(this._markers[this._markers.length-
2].getLatLng())},_cleanUpShape:function(){0<this._markers.length&&this._markers[this._markers.length-1].off("click",this._finishShape)}});L.Polygon.Draw=L.Polyline.Draw.extend({Poly:L.Polygon,options:{shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:0.5,fill:!0,fillColor:null,fillOpacity:0.2,clickable:!1}},_updateMarkerHandler:function(){1===this._markers.length&&this._markers[0].on("click",this._finishShape,this)},_getLabelText:function(){var d;return 0===this._markers.length?d="Click to start drawing shape.":
3>this._markers.length?d="Click to continue drawing shape.":d="Click first point to close this shape.",{text:d}},_vertexAdded:function(){},_cleanUpShape:function(){0<this._markers.length&&this._markers[0].off("click",this._finishShape)}});L.SimpleShape={};L.SimpleShape.Draw=L.Handler.Draw.extend({addHooks:function(){L.Handler.Draw.prototype.addHooks.call(this);this._map&&(this._map.dragging.disable(),this._container.style.cursor="crosshair",this._updateLabelText({text:this._initialLabelText}),this._map.on("mousedown",
this._onMouseDown,this).on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Handler.Draw.prototype.removeHooks.call(this);this._map&&(this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this),L.DomEvent.off(document,"mouseup",this._onMouseUp),this._shape&&(this._map.removeLayer(this._shape),delete this._shape));this._isDrawing=!1},_onMouseDown:function(d){this._isDrawing=!0;this._startLatLng=
d.latlng;this._updateLabelText({text:"Release mouse to finish drawing."});L.DomEvent.on(document,"mouseup",this._onMouseUp,this).preventDefault(d)},_onMouseMove:function(d){var c=d.layerPoint,d=d.latlng;this._updateLabelPosition(c);this._isDrawing&&(this._updateLabelPosition(c),this._drawShape(d))},_onMouseUp:function(){this._fireCreatedEvent();this.disable()}});L.Circle.Draw=L.SimpleShape.Draw.extend({options:{shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:0.5,fill:!0,fillColor:null,fillOpacity:0.2,
clickable:!0}},_initialLabelText:"Click and drag to draw circle.",_drawShape:function(d){this._shape?this._shape.setRadius(this._startLatLng.distanceTo(d)):(this._shape=new L.Circle(this._startLatLng,this._startLatLng.distanceTo(d),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){this._map.fire("draw:circle-created",{circ:new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions)})}});L.Rectangle.Draw=L.SimpleShape.Draw.extend({options:{shapeOptions:{stroke:!0,
color:"#f06eaa",weight:4,opacity:0.5,fill:!0,fillColor:null,fillOpacity:0.2,clickable:!0}},_initialLabelText:"Click and drag to draw rectangle.",_drawShape:function(d){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,d)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,d),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){this._map.fire("draw:rectangle-created",{rect:new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions)})}});
L.Marker.Draw=L.Handler.Draw.extend({options:{icon:new L.Icon.Default},addHooks:function(){L.Handler.Draw.prototype.addHooks.call(this);this._map&&(this._updateLabelText({text:"Click map to place marker."}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Handler.Draw.prototype.removeHooks.call(this);this._map&&(this._marker&&(this._marker.off("click",this._onClick),this._map.off("click",this._onClick).removeLayer(this._marker),delete this._marker),this._map.off("mousemove",
this._onMouseMove))},_onMouseMove:function(d){var c=d.latlng;this._updateLabelPosition(d.layerPoint);this._marker?this._marker.setLatLng(c):(this._marker=new L.Marker(c,{icon:this.options.icon}),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_onClick:function(){this._map.fire("draw:marker-created",{marker:new L.Marker(this._marker.getLatLng(),{icon:this.options.icon,draggable:!0})});this.disable()}});L.Map.mergeOptions({drawControl:!1});
L.Control.Draw=L.Control.extend({options:{position:"topleft",polyline:{title:"Draw a polyline"},polygon:{title:"Draw a polygon"},rectangle:{title:"Draw a rectangle"},circle:{title:"Draw a circle"},marker:{title:"Add a marker"}},handlers:{},initialize:function(d){L.Util.extend(this.options,d)},onAdd:function(d){var c=L.DomUtil.create("div","leaflet-control-draw");return this.options.polyline&&(this.handlers.polyline=new L.Polyline.Draw(d,this.options.polyline),this._createButton(this.options.polyline.title,
"leaflet-control-draw-polyline",c,this.handlers.polyline.enable,this.handlers.polyline),this.handlers.polyline.on("activated",this._disableInactiveModes,this)),this.options.polygon&&(this.handlers.polygon=new L.Polygon.Draw(d,this.options.polygon),this._createButton(this.options.polygon.title,"leaflet-control-draw-polygon",c,this.handlers.polygon.enable,this.handlers.polygon),this.handlers.polygon.on("activated",this._disableInactiveModes,this)),this.options.rectangle&&(this.handlers.rectangle=new L.Rectangle.Draw(d,
this.options.rectangle),this._createButton(this.options.rectangle.title,"leaflet-control-draw-rectangle",c,this.handlers.rectangle.enable,this.handlers.rectangle),this.handlers.rectangle.on("activated",this._disableInactiveModes,this)),this.options.circle&&(this.handlers.circle=new L.Circle.Draw(d,this.options.circle),this._createButton(this.options.circle.title,"leaflet-control-draw-circle",c,this.handlers.circle.enable,this.handlers.circle),this.handlers.circle.on("activated",this._disableInactiveModes,
this)),this.options.marker&&(this.handlers.marker=new L.Marker.Draw(d,this.options.marker),this._createButton(this.options.marker.title,"leaflet-control-draw-marker",c,this.handlers.marker.enable,this.handlers.marker),this.handlers.marker.on("activated",this._disableInactiveModes,this)),c},_createButton:function(d,c,e,b,a){c=L.DomUtil.create("a",c,e);return c.href="#",c.title=d,L.DomEvent.addListener(c,"click",L.DomEvent.stopPropagation).addListener(c,"click",L.DomEvent.preventDefault).addListener(c,
"click",b,a),c},_disableInactiveModes:function(){for(var d in this.handlers)this.handlers.hasOwnProperty(d)&&this.handlers[d].enabled&&this.handlers[d].disable()}});L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))})})();L.Control.FullScreen=L.Control.extend({options:{position:"topleft"},onAdd:function(d){var c,e;d.zoomControl?(e=d.zoomControl._container,c="-fullscreen last"):(e=L.DomUtil.create("div","leaflet-control-zoom"),c="-fullscreen");this._createButton("Full Screen","leaflet-control-zoom"+c,e,this.toogleFullScreen,d);return e},_createButton:function(d,c,e,b,a){c=L.DomUtil.create("a",c,e);c.href="#";c.title=d;L.DomEvent.addListener(c,"click",L.DomEvent.stopPropagation).addListener(c,"click",L.DomEvent.preventDefault).addListener(c,
"click",b,a);L.DomEvent.addListener(e,fullScreenApi.fullScreenEventName,L.DomEvent.stopPropagation).addListener(e,fullScreenApi.fullScreenEventName,L.DomEvent.preventDefault).addListener(e,fullScreenApi.fullScreenEventName,this._handleEscKey,a);L.DomEvent.addListener(document,fullScreenApi.fullScreenEventName,L.DomEvent.stopPropagation).addListener(document,fullScreenApi.fullScreenEventName,L.DomEvent.preventDefault).addListener(document,fullScreenApi.fullScreenEventName,this._handleEscKey,a);return c},
toogleFullScreen:function(){this._exitFired=!1;if(fullScreenApi.supportsFullScreen){var d=this._container;fullScreenApi.isFullScreen(d)?(fullScreenApi.cancelFullScreen(d),this.fire("exitFullscreen"),this._exitFired=!0):(fullScreenApi.requestFullScreen(d),this.fire("enterFullscreen"))}},_handleEscKey:function(){!fullScreenApi.isFullScreen(this)&&!this._exitFired&&(this.fire("exitFullscreen"),this._exitFired=!0)}});
(function(){var d={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},c=["webkit","moz","o","ms","khtml"];if("undefined"!=typeof document.cancelFullScreen)d.supportsFullScreen=!0;else for(var e=0,b=c.length;e<b;e++)if(d.prefix=c[e],"undefined"!=typeof document[d.prefix+"CancelFullScreen"]){d.supportsFullScreen=!0;break}d.supportsFullScreen&&(d.fullScreenEventName=d.prefix+"fullscreenchange",d.isFullScreen=
function(){switch(this.prefix){case "":return document.fullScreen;case "webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},d.requestFullScreen=function(a){return""===this.prefix?a.requestFullScreen():a[this.prefix+"RequestFullScreen"]()},d.cancelFullScreen=function(){return""===this.prefix?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()});"undefined"!=typeof jQuery&&(jQuery.fn.requestFullScreen=function(){return this.each(function(){var a=
jQuery(this);d.supportsFullScreen&&d.requestFullScreen(a)})});window.fullScreenApi=d})();/*
 MIT License
*/
(function(d){function c(){}function e(){}function b(){}function a(b,c){"string"==typeof c&&(c=c.split("."));var d=c.join(".").replace(/\.(\w)/g,function(a,b){return b.toUpperCase()}),f=c.shift(),e;return typeof(e=b[d])!=j||typeof(e=b[f])!=j&&0<c.length&&(e=a(e,c)),e}function f(){function a(b,f){d.bind(b,function(){return f.apply(c,arguments)})}var b=k.apply(arguments),c=this,d=1===b.length?c:b.shift(),f,b=b[0]||{};for(f in b)a(f,b[f])}function h(a,b){return{input:a,form:b}}var i=(JSON||{}).stringify,
k=Array.prototype.slice,j="undefined",l={itemManager:e,plugins:[],ext:{},html:{wrap:'<div class="text-core"><div class="text-wrap"/></div>',hidden:'<input type="hidden" />'},keys:{8:"backspace",9:"tab",13:"enter!",27:"escape!",37:"left",38:"up!",39:"right",40:"down!",46:"delete",108:"numpadEnter"}};if(!i)throw Error("JSON.stringify() not found");p=e.prototype;p.init=function(){};p.filter=function(a,b){var c=[],d,f;for(d=0;d<a.length;d++)f=a[d],this.itemContains(f,b)&&c.push(f);return c};p.itemContains=
function(a,b){return 0==this.itemToString(a).toLowerCase().indexOf(b.toLowerCase())};p.stringToItem=function(a){return a};p.itemToString=function(a){return a};p.compareItems=function(a,b){return a==b};p=c.prototype;p.init=function(a,b){var c=this,f,e,h;c._defaults=d.extend({},l);c._opts=b||{};c._plugins={};c._itemManager=e=new (c.opts("item.manager"));a=d(a);h=d(c.opts("html.wrap"));f=d(c.opts("html.hidden"));a.wrap(h).keydown(function(a){return c.onKeyDown(a)}).keyup(function(a){return c.onKeyUp(a)}).data("textext",
c);d(c).data({hiddenInput:f,wrapElement:a.parents(".text-wrap").first(),input:a});f.attr("name",a.attr("name"));a.attr("name",null);f.insertAfter(a);d.extend(!0,e,c.opts("ext.item.manager"));d.extend(!0,c,c.opts("ext.*"),c.opts("ext.core"));c.originalWidth=a.outerWidth();c.invalidateBounds();e.init(c);c.initPatches();c.initPlugins(c.opts("plugins"),d.fn.textext.plugins);c.on({setFormData:c.onSetFormData,getFormData:c.onGetFormData,setInputData:c.onSetInputData,anyKeyUp:c.onAnyKeyUp});c.trigger("postInit");
c.trigger("ready");c.getFormData(0)};p.initPatches=function(){var a=[],b=d.fn.textext.patches,c;for(c in b)a.push(c);this.initPlugins(a,b)};p.initPlugins=function(a,b){var c,f,e=[],h;"string"==typeof a&&(a=a.split(/\s*,\s*|\s+/g));for(h=0;h<a.length;h++)c=a[h],(f=b[c])&&(this._plugins[c]=f=new f,this[c]=function(a){return function(){return a}}(f),e.push(f),d.extend(!0,f,this.opts("ext.*"),this.opts("ext."+c)));e.sort(function(a,b){return a=a.initPriority(),b=b.initPriority(),a===b?0:a<b?1:-1});for(h=
0;h<e.length;h++)e[h].init(this)};p.hasPlugin=function(a){return!!this._plugins[a]};p.on=f;p.bind=function(a,b){this.input().bind(a,b)};p.trigger=function(){var a=arguments;this.input().trigger(a[0],k.call(a,1))};p.itemManager=function(){return this._itemManager};p.input=function(){return d(this).data("input")};p.opts=function(b){var c=a(this._opts,b);return"undefined"==typeof c?a(this._defaults,b):c};p.wrapElement=function(){return d(this).data("wrapElement")};p.invalidateBounds=function(){var a=
this.input(),b=this.wrapElement(),c=b.parent(),d=this.originalWidth,f;this.trigger("preInvalidate");f=a.outerHeight();a.width(d);b.width(d).height(f);c.height(f);this.trigger("postInvalidate")};p.focusInput=function(){this.input()[0].focus()};p.serializeData=i;p.hiddenInput=function(){return d(this).data("hiddenInput")};p.getWeightedEventResponse=function(a,b){var c={},d=0;this.trigger(a,c,b);for(var f in c)d=Math.max(d,f);return c[d]};p.getFormData=function(a){a=this.getWeightedEventResponse("getFormData",
a||0);this.trigger("setFormData",a.form);this.trigger("setInputData",a.input)};p.onAnyKeyUp=function(a,b){this.getFormData(b)};p.onSetInputData=function(a,b){this.input().val(b)};p.onSetFormData=function(a,b){this.hiddenInput().val(this.serializeData(b))};p.onGetFormData=function(a,b){var c=this.input().val();b[0]=h(c,c)};d(["Down","Up"]).each(function(){var a=this.toString();p["onKey"+a]=function(b){var c=this.opts("keys")[b.keyCode];return c&&(c.substr(-1),c=c.replace("!",""),this.trigger(c+"Key"+
a),"Up"==a&&this._lastKeyDown==b.keyCode&&(this._lastKeyDown=null,this.trigger(c+"KeyPress")),"Down"==a&&(this._lastKeyDown=b.keyCode)),this.trigger("anyKey"+a,b.keyCode),!0}});p=b.prototype;p.on=f;p.formDataObject=h;p.init=function(){throw Error("Not implemented");};p.baseInit=function(a,b){a._defaults=d.extend(!0,a._defaults,b);this._core=a;this._timers={}};p.startTimer=function(a,b,c){var d=this;d.stopTimer(a);d._timers[a]=setTimeout(function(){delete d._timers[a];c.apply(d)},1E3*b)};p.stopTimer=
function(a){clearTimeout(this._timers[a])};p.core=function(){return this._core};p.opts=function(a){return this.core().opts(a)};p.itemManager=function(){return this.core().itemManager()};p.input=function(){return this.core().input()};p.val=function(a){var b=this.input();if(typeof a===j)return b.val();b.val(a)};p.trigger=function(){var a=this.core();a.trigger.apply(a,arguments)};p.bind=function(a,b){this.core().bind(a,b)};p.initPriority=function(){return 0};var r=!1,m=d.fn.textext=function(a){var b;
return!r&&null!=(b=d.fn.textext.css)&&(d("head").append("<style>"+b+"</style>"),r=!0),this.map(function(){var b=d(this);if(null==a)return b.data("textext");var f=new c;return f.init(b,a),b.data("textext",f),f.input()[0]})};m.addPlugin=function(a,b){m.plugins[a]=b;b.prototype=new m.TextExtPlugin};m.addPatch=function(a,b){m.patches[a]=b;b.prototype=new m.TextExtPlugin};m.TextExt=c;m.TextExtPlugin=b;m.ItemManager=e;m.plugins={};m.patches={}})(jQuery);
(function(d){function c(){}d.fn.textext.TextExtIE9Patches=c;d.fn.textext.addPatch("ie9",c);d=c.prototype;d.init=function(c){if(-1!=navigator.userAgent.indexOf("MSIE 9"))c.on({postInvalidate:this.onPostInvalidate})};d.onPostInvalidate=function(){var c=this.input(),b=c.val();c.val(Math.random());c.val(b)}})(jQuery);
(function(d){function c(){}d.fn.textext.TextExtAjax=c;d.fn.textext.addPlugin("ajax",c);var e=c.prototype,b={ajax:{typeDelay:0.5,loadingMessage:"Loading...",loadingDelay:0.5,cacheResults:!1,dataCallback:null}};e.init=function(a){this.baseInit(a,b);this.on({getSuggestions:this.onGetSuggestions});this._suggestions=null};e.load=function(a){var b=this,c=b.opts("ajax.data.callback")||function(a){return{q:a}},c=d.extend(!0,{data:c(a),success:function(c){b.onComplete(c,a)},error:function(b,c){console.error(c,
a)}},b.opts("ajax"));d.ajax(c)};e.onComplete=function(a,b){var c=a;this.dontShowLoading();1==this.opts("ajax.cache.results")&&(this._suggestions=a,c=this.itemManager().filter(a,b));this.trigger("setSuggestions",{result:c})};e.dontShowLoading=function(){this.stopTimer("loading")};e.showLoading=function(){var a=this;a.dontShowLoading();a.startTimer("loading",a.opts("ajax.loading.delay"),function(){a.trigger("showDropdown",function(b){b.clearItems();b.addDropdownItem(a.opts("ajax.loading.message")).addClass("text-loading")})})};
e.onGetSuggestions=function(a,b){var c=this,d=c._suggestions,e=(b||{}).query||"";if(d&&!0===c.opts("ajax.cache.results"))return c.onComplete(d,e);c.startTimer("ajax",c.opts("ajax.type.delay"),function(){c.showLoading();c.load(e)})}})(jQuery);
(function(d){function c(){}d.fn.textext.TextExtArrow=c;d.fn.textext.addPlugin("arrow",c);var e=c.prototype,b={html:{arrow:'<div class="text-arrow"/>'}};e.init=function(a){var c=this;c.baseInit(a,b);c._arrow=a=d(c.opts("html.arrow"));c.core().wrapElement().append(a);a.bind("click",function(a){c.onArrowClick(a)})};e.onArrowClick=function(){this.trigger("toggleDropdown");this.core().focusInput()}})(jQuery);
(function(d){function c(){}d.fn.textext.TextExtAutocomplete=c;d.fn.textext.addPlugin("autocomplete",c);var e=c.prototype,b={autocomplete:{enabled:!0,dropdown:{position:"below",maxHeight:"100px"}},html:{dropdown:'<div class="text-dropdown"><div class="text-list"/></div>',suggestion:'<div class="text-suggestion"><span class="text-label"/></div>'}};e.init=function(a){var c=this;c.baseInit(a,b);var a=c.input(),e;!0===c.opts("autocomplete.enabled")&&(c.on({blur:c.onBlur,anyKeyUp:c.onAnyKeyUp,deleteKeyUp:c.onAnyKeyUp,
backspaceKeyPress:c.onBackspaceKeyPress,enterKeyPress:c.onEnterKeyPress,escapeKeyPress:c.onEscapeKeyPress,setSuggestions:c.onSetSuggestions,showDropdown:c.onShowDropdown,hideDropdown:c.onHideDropdown,toggleDropdown:c.onToggleDropdown,postInvalidate:c.positionDropdown,getFormData:c.onGetFormData,downKeyDown:c.onDownKeyDown,upKeyDown:c.onUpKeyDown}),e=d(c.opts("html.dropdown")),e.insertAfter(a),c.on(e,{mouseover:c.onMouseOver,mousedown:c.onMouseDown,click:c.onClick}),e.css("maxHeight",c.opts("autocomplete.dropdown.maxHeight")).addClass("text-position-"+
c.opts("autocomplete.dropdown.position")),d(c).data("container",e),d(document.body).click(function(a){c.isDropdownVisible()&&!c.withinWrapElement(a.target)&&c.trigger("hideDropdown")}),c.positionDropdown())};e.containerElement=function(){return d(this).data("container")};e.onMouseOver=function(a){a=d(a.target);a.is(".text-suggestion")&&(this.clearSelected(),a.addClass("text-selected"))};e.onMouseDown=function(){this.containerElement().data("mousedownOnAutocomplete",!0)};e.onClick=function(a){a=d(a.target);
(a.is(".text-suggestion")||a.is(".text-label"))&&this.trigger("enterKeyPress");this.core().hasPlugin("tags")&&this.val("")};e.onBlur=function(){var a=this.containerElement(),b=!0===a.data("mousedownOnAutocomplete");this.isDropdownVisible()&&(b?this.core().focusInput():this.trigger("hideDropdown"));a.removeData("mousedownOnAutocomplete")};e.onBackspaceKeyPress=function(){(0<this.val().length||this.isDropdownVisible())&&this.getSuggestions()};e.onAnyKeyUp=function(a,b){var c=null!=this.opts("keys."+
b);0<this.val().length&&!c&&this.getSuggestions()};e.onDownKeyDown=function(){this.isDropdownVisible()?this.toggleNextSuggestion():this.getSuggestions()};e.onUpKeyDown=function(){this.togglePreviousSuggestion()};e.onEnterKeyPress=function(){this.isDropdownVisible()&&this.selectFromDropdown()};e.onEscapeKeyPress=function(){this.isDropdownVisible()&&this.trigger("hideDropdown")};e.positionDropdown=function(){var a=this.containerElement(),b=this.opts("autocomplete.dropdown.position"),c=this.core().wrapElement().outerHeight(),
d={};d["above"===b?"bottom":"top"]=c+"px";a.css(d)};e.suggestionElements=function(){return this.containerElement().find(".text-suggestion")};e.setSelectedSuggestion=function(a){if(a){var b=this.suggestionElements(),c=b.first(),e,k;this.clearSelected();for(k=0;k<b.length;k++)if(e=d(b[k]),this.itemManager().compareItems(e.data("text-suggestion"),a)){c=e.addClass("text-selected");break}c.addClass("text-selected");this.scrollSuggestionIntoView(c)}};e.selectedSuggestionElement=function(){return this.suggestionElements().filter(".text-selected").first()};
e.isDropdownVisible=function(){return!0===this.containerElement().is(":visible")};e.onGetFormData=function(a,b){var c=this.val();b[100]=this.formDataObject(c,c)};e.initPriority=function(){return 200};e.onHideDropdown=function(){this.hideDropdown()};e.onToggleDropdown=function(){this.trigger(this.containerElement().is(":visible")?"hideDropdown":"showDropdown")};e.onShowDropdown=function(a,b){var c=this.selectedSuggestionElement().data("text-suggestion");if(!this._suggestions)return this.trigger("getSuggestions");
d.isFunction(b)?b(this):(this.renderSuggestions(this._suggestions),this.toggleNextSuggestion());this.showDropdown(this.containerElement());this.setSelectedSuggestion(c)};e.onSetSuggestions=function(a,b){var c=this._suggestions=b.result;!1!==b.showHideDropdown&&this.trigger(null===c||0===c.length?"hideDropdown":"showDropdown")};e.getSuggestions=function(){var a=this.val();this._previousInputValue!=a&&(""==a&&(current=null),this._previousInputValue=a,this.trigger("getSuggestions",{query:a}))};e.clearItems=
function(){this.containerElement().find(".text-list").children().remove()};e.renderSuggestions=function(a){var b=this;b.clearItems();d.each(a||[],function(a,c){b.addSuggestion(c)})};e.showDropdown=function(){this.containerElement().show()};e.hideDropdown=function(){var a=this.containerElement();this._previousInputValue=null;a.hide()};e.addSuggestion=function(a){var b=this.opts("autocomplete.render");this.addDropdownItem(b?b.call(this,a):this.itemManager().itemToString(a)).data("text-suggestion",a)};
e.addDropdownItem=function(a){var b=this.containerElement().find(".text-list"),c=d(this.opts("html.suggestion"));return c.find(".text-label").html(a),b.append(c),c};e.clearSelected=function(){this.suggestionElements().removeClass("text-selected")};e.toggleNextSuggestion=function(){var a=this.selectedSuggestionElement(),b;0<a.length?(b=a.next(),0<b.length&&a.removeClass("text-selected")):b=this.suggestionElements().first();b.addClass("text-selected");this.scrollSuggestionIntoView(b)};e.togglePreviousSuggestion=
function(){var a=this.selectedSuggestionElement().prev();0!=a.length&&(this.clearSelected(),a.addClass("text-selected"),this.scrollSuggestionIntoView(a))};e.scrollSuggestionIntoView=function(a){var b=a.outerHeight(),c=this.containerElement(),d=c.innerHeight(),e=c.scrollTop(),a=(a.position()||{}).top,j=null,l=parseInt(c.css("paddingTop"));null!=a&&(a+b>d&&(j=a+e+b-d+l),0>a&&(j=a+e-l),null!=j&&c.scrollTop(j))};e.selectFromDropdown=function(){var a=this.selectedSuggestionElement().data("text-suggestion");
a&&(this.val(this.itemManager().itemToString(a)),this.core().getFormData());this.trigger("hideDropdown")};e.withinWrapElement=function(a){return 0<this.core().wrapElement().find(a).size()}})(jQuery);
(function(d){function c(){}d.fn.textext.TextExtFilter=c;d.fn.textext.addPlugin("filter",c);var d=c.prototype,e={filter:{enabled:!0,items:null}};d.init=function(b){this.baseInit(b,e);this.on({getFormData:this.onGetFormData,isTagAllowed:this.onIsTagAllowed,setSuggestions:this.onSetSuggestions});this._suggestions=null};d.onGetFormData=function(b,a){var c=this.val(),d="";this.core().hasPlugin("tags")||(this.isValueAllowed(c)&&(d=c),a[300]=this.formDataObject(c,d))};d.isValueAllowed=function(b){var a=
this.opts("filterItems")||this._suggestions||[],c=this.itemManager(),d=!this.opts("filter.enabled"),e;for(e=0;e<a.length&&!d;e++)c.compareItems(b,a[e])&&(d=!0);return d};d.onIsTagAllowed=function(b,a){a.result=this.isValueAllowed(a.tag)};d.onSetSuggestions=function(b,a){this._suggestions=a.result}})(jQuery);
(function(d){function c(){}d.fn.textext.TextExtFocus=c;d.fn.textext.addPlugin("focus",c);var d=c.prototype,e={html:{focus:'<div class="text-focus"/>'}};d.init=function(b){this.baseInit(b,e);this.core().wrapElement().append(this.opts("html.focus"));this.on({blur:this.onBlur,focus:this.onFocus});this._timeoutId=0};d.onBlur=function(){var b=this;clearTimeout(b._timeoutId);b._timeoutId=setTimeout(function(){b.getFocus().hide()},100)};d.onFocus=function(){clearTimeout(this._timeoutId);this.getFocus().show()};
d.getFocus=function(){return this.core().wrapElement().find(".text-focus")}})(jQuery);
(function(d){function c(){}d.fn.textext.TextExtPrompt=c;d.fn.textext.addPlugin("prompt",c);var e=c.prototype,b={prompt:"Awaiting input...",html:{prompt:'<div class="text-prompt"/>'}};e.init=function(a){var c;this.baseInit(a,b);c=d(this.opts("html.prompt"));d(this).data("container",c);this.core().wrapElement().append(c);this.setPrompt(this.opts("prompt"));(c=a.input().attr("placeholder"))||(c=this.opts("prompt"));a.input().attr("placeholder","");c&&this.setPrompt(c);0<d.trim(this.val()).length&&this.hidePrompt();
this.on({blur:this.onBlur,focus:this.onFocus,postInvalidate:this.onPostInvalidate,postInit:this.onPostInit})};e.onPostInit=function(){this.invalidateBounds()};e.onPostInvalidate=function(){this.invalidateBounds()};e.invalidateBounds=function(){var a=this.input();this.containerElement().css({paddingLeft:a.css("paddingLeft"),paddingTop:a.css("paddingTop")})};e.onBlur=function(){var a=this;a.startTimer("prompt",0.1,function(){a.showPrompt()})};e.showPrompt=function(){var a=this.input();0===d.trim(this.val()).length&&
!a.is(":focus")&&this.containerElement().removeClass("text-hide-prompt")};e.hidePrompt=function(){this.stopTimer("prompt");this.containerElement().addClass("text-hide-prompt")};e.onFocus=function(){this.hidePrompt()};e.setPrompt=function(a){this.containerElement().text(a)};e.containerElement=function(){return d(this).data("container")}})(jQuery);
(function(d){function c(){}d.fn.textext.TextExtSuggestions=c;d.fn.textext.addPlugin("suggestions",c);var d=c.prototype,e={suggestions:null};d.init=function(b){this.baseInit(b,e);this.on({getSuggestions:this.onGetSuggestions,postInit:this.onPostInit})};d.setSuggestions=function(b,a){this.trigger("setSuggestions",{result:b,showHideDropdown:0!=a})};d.onPostInit=function(){this.setSuggestions(this.opts("suggestions"),!1)};d.onGetSuggestions=function(b,a){var c=this.opts("suggestions");c.sort();this.setSuggestions(this.itemManager().filter(c,
a.query))}})(jQuery);
(function(d){function c(){}d.fn.textext.TextExtTags=c;d.fn.textext.addPlugin("tags",c);var e=c.prototype,b="text-tag",a="."+b,f=".text-label",h={tags:{enabled:!0,items:null},html:{tags:'<div class="text-tags"/>',tag:'<div class="text-tag"><div class="text-button"><span class="text-label"/><a class="text-remove"/></div></div>'}};e.init=function(a){this.baseInit(a,h);var a=this.input(),b;this.opts("tags.enabled")&&(b=d(this.opts("html.tags")),a.after(b),d(this).data("container",b),this.on({enterKeyPress:this.onEnterKeyPress,
backspaceKeyDown:this.onBackspaceKeyDown,preInvalidate:this.onPreInvalidate,postInit:this.onPostInit,getFormData:this.onGetFormData}),this.on(b,{click:this.onClick,mousemove:this.onContainerMouseMove}),this.on(a,{mousemove:this.onInputMouseMove}));this._originalPadding={left:parseInt(a.css("paddingLeft")||0),top:parseInt(a.css("paddingTop")||0)};this._paddingBox={left:0,top:0};this.updateFormCache()};e.containerElement=function(){return d(this).data("container")};e.onPostInit=function(){this.addTags(this.opts("tags.items"))};
e.onGetFormData=function(a,b,c){a=13===c?"":this.val();b[200]=this.formDataObject(a,this._formData)};e.initPriority=function(){return 100};e.onInputMouseMove=function(a){this.toggleZIndex(a)};e.onContainerMouseMove=function(a){this.toggleZIndex(a)};e.onBackspaceKeyDown=function(){var a=this.tagElements().last();0==this.val().length&&this.removeTag(a)};e.onPreInvalidate=function(){var a=this.tagElements().last(),b=a.position();0<a.length?b.left+=a.innerWidth():b=this._originalPadding;this._paddingBox=
b;this.input().css({paddingLeft:b.left,paddingTop:b.top})};e.onClick=function(c){function e(a,c){m.data(b,a);m.find(f).text(h.itemManager().itemToString(a));h.updateFormCache();l.getFormData();l.invalidateBounds();c&&l.focusInput()}var h=this,l=h.core(),c=d(c.target),r=0,m;c.is(".text-tags")?r=1:c.is(".text-remove")?(h.removeTag(c.parents(a+":first")),r=1):c.is(f)&&(m=c.parents(a+":first"),h.trigger("tagClick",m,m.data(b),e));r&&l.focusInput()};e.onEnterKeyPress=function(){var a=this.val(),a=this.itemManager().stringToItem(a);
this.isTagAllowed(a)&&(this.addTags([a]),this.core().focusInput())};e.updateFormCache=function(){var a=[];this.tagElements().each(function(){a.push(d(this).data(b))});this._formData=a};e.toggleZIndex=function(a){var b=this.input().offset(),c=a.clientX-b.left,d=a.clientY-b.top,e=this._paddingBox,a=this.containerElement(),b=a.is(".text-tags-on-top"),c=c>e.left&&d>e.top;(!b&&!c||b&&c)&&a[(b?"remove":"add")+"Class"]("text-tags-on-top")};e.tagElements=function(){return this.containerElement().find(a)};
e.isTagAllowed=function(a){a={tag:a,result:!0};return this.trigger("isTagAllowed",a),!0===a.result};e.addTags=function(a){if(a&&0!=a.length){var b=this.core(),c=this.containerElement(),d,e;for(d=0;d<a.length;d++)(e=a[d])&&this.isTagAllowed(e)&&c.append(this.renderTag(e));this.updateFormCache();b.getFormData();b.invalidateBounds()}};e.getTagElement=function(a){var c=this.tagElements(),e,f;for(e=0;e<c.length,f=d(c[e]);e++)if(this.itemManager().compareItems(f.data(b),a))return f};e.removeTag=function(a){var c=
this.core(),e;a instanceof d?(e=a,a.data(b)):e=this.getTagElement(a);e.remove();this.updateFormCache();c.getFormData();c.invalidateBounds()};e.renderTag=function(a){var c=d(this.opts("html.tag"));return c.find(".text-label").text(this.itemManager().itemToString(a)),c.data(b,a),c}})(jQuery);(function(d){var c=document,e=c.getElementsByTagName("head")[0]||c.getElementsByTagName("body")[0],c=c.createElement("style");c.innerHTML=d;e.appendChild(c)})('\n.text-core{position:relative;}\n.text-core .text-wrap{background:#fff;position:absolute;}\n.text-core .text-wrap textarea,.text-core .text-wrap input{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;-webkit-border-radius:0px;-moz-border-radius:0px;border-radius:0px;border:1px solid #9daccc;outline:none;resize:none;position:absolute;z-index:1;background:none;overflow:hidden;margin:0;padding:3px 5px 4px 5px;white-space:nowrap;font:11px "lucida grande",tahoma,verdana,arial,sans-serif;line-height:13px;height:auto;}\n\n.text-core .text-wrap .text-arrow{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;top:0;right:0;width:22px;height:22px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAOAQMAAADHWqTrAAAAA3NCSVQICAjb4U/gAAAABlBMVEX///8yXJnt8Ns4AAAACXBIWXMAAAsSAAALEgHS3X78AAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1MzmNZGAwAAABpJREFUCJljYEAF/xsY6hkY7BgYZBgYOFBkADkdAmFDagYFAAAAAElFTkSuQmCC") 50% 50% no-repeat;cursor:pointer;z-index:2;}\n\n.text-core .text-wrap .text-dropdown{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0;position:absolute;z-index:3;background:#fff;border:1px solid #9daccc;width:100%;max-height:100px;padding:1px;font:11px "lucida grande",tahoma,verdana,arial,sans-serif;display:none;overflow-x:hidden;overflow-y:auto;}\n.text-core .text-wrap .text-dropdown.text-position-below{margin-top:1px;}\n.text-core .text-wrap .text-dropdown.text-position-above{margin-bottom:1px;}\n.text-core .text-wrap .text-dropdown .text-list .text-suggestion{padding:3px 5px;cursor:pointer;}\n.text-core .text-wrap .text-dropdown .text-list .text-suggestion em{font-style:normal;text-decoration:underline;}\n.text-core .text-wrap .text-dropdown .text-list .text-suggestion.text-selected{color:#fff;background:#6d84b4;}\n\n.text-core .text-wrap .text-focus{-webkit-box-shadow:0px 0px 6px #6d84b4;-moz-box-shadow:0px 0px 6px #6d84b4;box-shadow:0px 0px 6px #6d84b4;position:absolute;width:100%;height:100%;display:none;}\n.text-core .text-wrap .text-focus.text-show-focus{display:block;}\n\n.text-core .text-wrap .text-prompt{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;width:100%;height:100%;margin:1px 0 0 2px;font:11px "lucida grande",tahoma,verdana,arial,sans-serif;color:#c0c0c0;overflow:hidden;white-space:pre;}\n.text-core .text-wrap .text-prompt.text-hide-prompt{display:none;}\n\n.text-core .text-wrap .text-tags{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;width:100%;height:100%;padding:3px 35px 3px 3px;cursor:text;}\n.text-core .text-wrap .text-tags.text-tags-on-top{z-index:2;}\n.text-core .text-wrap .text-tags .text-tag{float:left;}\n.text-core .text-wrap .text-tags .text-tag .text-button{-webkit-border-radius:2px;-moz-border-radius:2px;border-radius:2px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;float:left;border:1px solid #9daccc;background:#e2e6f0;color:#000;padding:0px 17px 0px 3px;margin:0 2px 2px 0;cursor:pointer;height:16px;font:11px "lucida grande",tahoma,verdana,arial,sans-serif;}\n.text-core .text-wrap .text-tags .text-tag .text-button a.text-remove{position:absolute;right:3px;top:2px;display:block;width:11px;height:11px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAhCAYAAAAPm1F2AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB50RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNS4xqx9I6wAAAQ5JREFUOI2dlD0WwiAQhCc8L6HHgAPoASwtSYvX8BrQxtIyveYA8RppLO1jE+LwE8lzms2yH8MCj1QoaBzH+VuUYNYMS213UlvDRamtUbXb5ZyPHuDoxwGgip3ipfvGuGzPz+vZ/coDONdzFuYCO6ramQQG0DJIE1oPBBvM6e9LqaS2FwD7FWwnVoIAsOc2Xn1jDlyd8pfPBRVOBHA8cc/3yCmQqt0jcY4LuTyAF3pOYS6wI48LAm4MUrx5JthgSQJAt5LtNgAUgEMBBIC3AL2xgo58dEPfhE9wygef89FtCeC49UwltR1pQrK2qr9vNr7uRTCBF3pOYS6wI4/zdQ8MUpxPI9hgSQL0Xyio/QBt54DzsHQx6gAAAABJRU5ErkJggg==") 0 0 no-repeat;}\n.text-core .text-wrap .text-tags .text-tag .text-button a.text-remove:hover{background-position:0 -11px;}\n.text-core .text-wrap .text-tags .text-tag .text-button a.text-remove:active{background-position:0 -22px;}\n');
